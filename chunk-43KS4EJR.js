import{a as S}from"./chunk-P3QYGIAU.js";import{a as k}from"./chunk-AJHYPDYV.js";import{a as z}from"./chunk-D4COT2E2.js";import"./chunk-O6YQIL4L.js";import{a as y}from"./chunk-SJBCNNOS.js";import{u as w}from"./chunk-XGVRFAFZ.js";import{a as v,b as x}from"./chunk-4BWE2P25.js";import{$a as d,Ka as P,Z as b,ab as c,bb as a,cb as f,lb as O,p as C,rc as _,yb as m,za as g}from"./chunk-3XB4H34J.js";var D=class M{teacherApi=b(z);stats={totalStudents:0,totalExams:0,averageScore:0,avgDuration:0};quizzes=[];courses=[];isLoading=!0;scoreDistribution={excellent:{count:0,percentage:0},good:{count:0,percentage:0},average:{count:0,percentage:0},below:{count:0,percentage:0},failing:{count:0,percentage:0}};trendChartData={labels:[],datasets:[]};trendChartOptions={};distributionChartData={labels:[],datasets:[]};distributionChartOptions={};topPerformers=[];topPerformerColumns=[{key:"rank",label:"Rank"},{key:"name",label:"Student"},{key:"score",label:"Avg Score"},{key:"exams",label:"Exams"}];ngOnInit(){this.loadStatistics()}async loadStatistics(){this.isLoading=!0;try{let[n,r]=await Promise.all([C(this.teacherApi.getMyQuizzes()),C(this.teacherApi.getMyCourses())]);this.quizzes=n,this.courses=r,this.computeStats()}catch(n){console.error("Error loading statistics:",n)}finally{this.isLoading=!1}}computeStats(){this.stats.totalExams=this.quizzes.length;let n=new Set,r=0,e=0,t=0,o=0;for(let s of this.quizzes)if(o+=s.durationMinutes||0,s.studentQuizes){for(let i of s.studentQuizes)if(i.student?.id&&n.add(i.student.id),i.rawScore!==null&&i.rawScore!==void 0&&i.totalMarks){r+=i.rawScore,e+=i.totalMarks,t++;let l=i.rawScore/i.totalMarks*100;l>=90?this.scoreDistribution.excellent.count++:l>=80?this.scoreDistribution.good.count++:l>=70?this.scoreDistribution.average.count++:l>=60?this.scoreDistribution.below.count++:this.scoreDistribution.failing.count++}}this.stats.totalStudents=n.size,this.stats.averageScore=e>0?r/e*100:0,this.stats.avgDuration=this.quizzes.length>0?Math.round(o/this.quizzes.length):0,t>0&&(this.scoreDistribution.excellent.percentage=this.scoreDistribution.excellent.count/t*100,this.scoreDistribution.good.percentage=this.scoreDistribution.good.count/t*100,this.scoreDistribution.average.percentage=this.scoreDistribution.average.count/t*100,this.scoreDistribution.below.percentage=this.scoreDistribution.below.count/t*100,this.scoreDistribution.failing.percentage=this.scoreDistribution.failing.count/t*100);let h=[],u=[];for(let s of this.quizzes){h.push(`${s.type}${s.date?" - "+new Date(s.date).toLocaleDateString():""}`);let i=0,l=0;if(s.studentQuizes)for(let p of s.studentQuizes)p.rawScore!==void 0&&p.rawScore!==null&&p.totalMarks&&(i+=p.rawScore,l+=p.totalMarks);u.push(l>0?i/l*100:0)}this.trendChartData={labels:h,datasets:[{label:"Average Score (%)",data:u,borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,0.2)",tension:.2}]},this.trendChartOptions={responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,max:100}}},this.distributionChartData={labels:["90-100","80-89","70-79","60-69","<60"],datasets:[{data:[this.scoreDistribution.excellent.count,this.scoreDistribution.good.count,this.scoreDistribution.average.count,this.scoreDistribution.below.count,this.scoreDistribution.failing.count],backgroundColor:["#10b981","#3b82f6","#f59e0b","#f97316","#ef4444"]}]},this.distributionChartOptions={responsive:!0,plugins:{legend:{position:"bottom"}}},this.computeTopPerformers()}computeTopPerformers(){let n=new Map;for(let e of this.quizzes)if(e.studentQuizes)for(let t of e.studentQuizes){let o=t.student?.id||(t.student?.user?.id??`${e.id}-${Math.random()}`),h=t.student?`${t.student.user?.name||""} ${t.student.user?.surname||""}`.trim():"Unknown";n.has(o)||n.set(o,{name:h,totalRaw:0,totalMarks:0,exams:0});let u=n.get(o);t.rawScore!==void 0&&t.rawScore!==null&&t.totalMarks&&(u.totalRaw+=t.rawScore,u.totalMarks+=t.totalMarks,u.exams+=1)}let r=Array.from(n.entries()).map(([e,t])=>({name:t.name||"Unknown",score:t.totalMarks>0?Math.round(t.totalRaw/t.totalMarks*1e3)/10:0,exams:t.exams}));r.sort((e,t)=>t.score-e.score),this.topPerformers=r.slice(0,10).map((e,t)=>({rank:t+1,name:e.name,score:e.score,exams:e.exams}))}exportData(){console.log("Exporting statistics data");let n={stats:this.stats,quizzes:this.quizzes.map(o=>({id:o.id,type:o.type,date:o.date,duration:o.durationMinutes,questionsCount:k(o),studentsCount:o.studentQuizes?.length||0}))},r=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),e=URL.createObjectURL(r),t=document.createElement("a");t.href=e,t.download=`teacher-statistics-${new Date().toISOString().split("T")[0]}.json`,t.click(),URL.revokeObjectURL(e)}static \u0275fac=function(r){return new(r||M)};static \u0275cmp=P({type:M,selectors:[["app-teacher-statistics"]],decls:32,vars:19,consts:[[1,"statistics"],[1,"page-header"],[1,"stats-overview"],["label","Total Students","color","primary","format","number",3,"value"],["label","Exams Conducted","color","accent","format","number",3,"value"],["label","Average Score","color","success","format","percent",3,"value","showProgress","progress"],["label","Avg Duration (min)","color","info","format","number",3,"value"],[1,"analytics-grid"],[1,"chart-section"],[1,"chart-card"],[1,"chart-header"],[3,"type","data","options","disableAnimations"],[1,"export-btn",3,"click"],[1,"insights-section"],[1,"top-performers-card"],[3,"columns","data","showHeader","showPagination","rowClickable"]],template:function(r,e){r&1&&(c(0,"div",0)(1,"div",1)(2,"h1"),m(3,"Statistics & Analytics"),a(),c(4,"p"),m(5,"Overview of recent quizzes and student performance."),a()(),c(6,"div",2),f(7,"ui-stat-card",3)(8,"ui-stat-card",4)(9,"ui-stat-card",5)(10,"ui-stat-card",6),a(),c(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"h3"),m(16,"Performance Trends"),a()(),f(17,"ui-chart",11),a(),c(18,"div",9)(19,"div",10)(20,"h3"),m(21,"Score Distribution"),a(),c(22,"button",12),O("click",function(){return e.exportData()}),c(23,"mat-icon"),m(24,"file_download"),a(),m(25," Export "),a()(),f(26,"ui-chart",11),a()(),c(27,"div",13)(28,"div",14)(29,"h3"),m(30,"Top Performers"),a(),f(31,"ui-table",15),a()()()()),r&2&&(g(7),d("value",e.stats.totalStudents),g(),d("value",e.stats.totalExams),g(),d("value",e.stats.averageScore)("showProgress",!0)("progress",e.stats.averageScore),g(),d("value",e.stats.avgDuration),g(7),d("type","line")("data",e.trendChartData)("options",e.trendChartOptions)("disableAnimations",!1),g(9),d("type","pie")("data",e.distributionChartData)("options",e.distributionChartOptions)("disableAnimations",!1),g(5),d("columns",e.topPerformerColumns)("data",e.topPerformers)("showHeader",!0)("showPagination",!1)("rowClickable",!1))},dependencies:[_,x,v,y,S,w],styles:[".statistics[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;margin-bottom:.5rem;color:var(--color-text-primary)}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:1rem}.stats-overview[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}.overview-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px #0000001a;display:flex;align-items:center;gap:1rem}.overview-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{background:var(--color-primary-50);border-radius:12px;padding:1rem;display:flex;align-items:center;justify-content:center}.overview-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-primary-600);font-size:1.5rem;width:1.5rem;height:1.5rem}.overview-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{flex:1}.overview-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text-secondary);margin-bottom:.25rem}.overview-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .main-stat[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:var(--color-text-primary);margin-bottom:.25rem}.overview-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .trend[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500}.overview-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .trend.positive[_ngcontent-%COMP%]{color:var(--color-success-600)}.overview-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .trend.negative[_ngcontent-%COMP%]{color:var(--color-error-600)}.analytics-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:2rem;margin-bottom:2rem}@media (max-width: 1024px){.analytics-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.chart-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.chart-card[_ngcontent-%COMP%], .insights-card[_ngcontent-%COMP%], .top-performers-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px #0000001a;display:flex;flex-direction:column;min-height:320px}.chart-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.chart-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--color-text-primary)}.chart-card[_ngcontent-%COMP%]   ui-chart[_ngcontent-%COMP%], .chart-card[_ngcontent-%COMP%]   ui-chart[_ngcontent-%COMP%]   .chart-host[_ngcontent-%COMP%]{height:100%;min-height:240px;display:block}.time-filter[_ngcontent-%COMP%], .subject-filter[_ngcontent-%COMP%]{padding:.5rem .75rem;border:1px solid var(--color-border);border-radius:6px;font-size:.875rem}.export-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;padding:.5rem .75rem;background:var(--color-primary-600);color:#fff;border:none;border-radius:6px;font-size:.875rem;cursor:pointer;transition:background .2s}.export-btn[_ngcontent-%COMP%]:hover{background:var(--color-primary-700)}.chart-placeholder[_ngcontent-%COMP%]{height:300px;border:2px dashed var(--color-border);border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--color-text-secondary)}.chart-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;margin-bottom:.5rem}.score-distribution[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.score-range[_ngcontent-%COMP%]{display:grid;grid-template-columns:80px 1fr 100px;align-items:center;gap:1rem}.score-range[_ngcontent-%COMP%]   .range-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text-primary)}.score-range[_ngcontent-%COMP%]   .range-bar[_ngcontent-%COMP%]{height:8px;background:var(--color-background-muted);border-radius:4px;overflow:hidden}.score-range[_ngcontent-%COMP%]   .range-bar[_ngcontent-%COMP%]   .range-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s}.score-range[_ngcontent-%COMP%]   .range-bar[_ngcontent-%COMP%]   .range-fill.excellent[_ngcontent-%COMP%]{background:var(--color-success-500)}.score-range[_ngcontent-%COMP%]   .range-bar[_ngcontent-%COMP%]   .range-fill.good[_ngcontent-%COMP%]{background:var(--color-primary-500)}.score-range[_ngcontent-%COMP%]   .range-bar[_ngcontent-%COMP%]   .range-fill.average[_ngcontent-%COMP%]{background:var(--color-warning-500)}.score-range[_ngcontent-%COMP%]   .range-bar[_ngcontent-%COMP%]   .range-fill.below[_ngcontent-%COMP%]{background:var(--color-error-500)}.score-range[_ngcontent-%COMP%]   .range-count[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary);text-align:right}.insights-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.insights-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .top-performers-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1.5rem;color:var(--color-text-primary)}.insights-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.insight-item[_ngcontent-%COMP%]{display:flex;gap:.75rem}.insight-item[_ngcontent-%COMP%]   .insight-icon[_ngcontent-%COMP%]{padding:.5rem;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.insight-item[_ngcontent-%COMP%]   .insight-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.insight-item[_ngcontent-%COMP%]   .insight-icon.positive[_ngcontent-%COMP%]{background:var(--color-success-100)}.insight-item[_ngcontent-%COMP%]   .insight-icon.positive[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-success-600)}.insight-item[_ngcontent-%COMP%]   .insight-icon.warning[_ngcontent-%COMP%]{background:var(--color-warning-100)}.insight-item[_ngcontent-%COMP%]   .insight-icon.warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-warning-600)}.insight-item[_ngcontent-%COMP%]   .insight-icon.info[_ngcontent-%COMP%]{background:var(--color-primary-100)}.insight-item[_ngcontent-%COMP%]   .insight-icon.info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-primary-600)}.insight-item[_ngcontent-%COMP%]   .insight-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;margin-bottom:.25rem;color:var(--color-text-primary)}.insight-item[_ngcontent-%COMP%]   .insight-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-text-secondary);line-height:1.4}.performers-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.performer-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:var(--color-background-subtle);border-radius:8px}.performer-item[_ngcontent-%COMP%]   .performer-rank[_ngcontent-%COMP%]{width:2rem;height:2rem;background:var(--color-primary-600);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.875rem}.performer-item[_ngcontent-%COMP%]   .performer-info[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:space-between;align-items:center}.performer-item[_ngcontent-%COMP%]   .performer-info[_ngcontent-%COMP%]   .performer-name[_ngcontent-%COMP%]{font-weight:500;color:var(--color-text-primary)}.performer-item[_ngcontent-%COMP%]   .performer-info[_ngcontent-%COMP%]   .performer-score[_ngcontent-%COMP%]{font-weight:600;color:var(--color-success-600)}.detailed-analytics[_ngcontent-%COMP%]{margin-bottom:2rem}.analytics-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px #0000001a}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--color-text-primary)}.subject-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.subject-stat[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;border:1px solid var(--color-border);border-radius:8px}@media (max-width: 768px){.subject-stat[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}}.subject-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.subject-info[_ngcontent-%COMP%]   .subject-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--color-text-primary)}.subject-info[_ngcontent-%COMP%]   .subject-exams[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary)}.subject-metrics[_ngcontent-%COMP%]{display:flex;gap:2rem}@media (max-width: 768px){.subject-metrics[_ngcontent-%COMP%]{gap:1rem}}.metric[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.metric[_ngcontent-%COMP%]   .metric-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-text-secondary);margin-bottom:.25rem}.metric[_ngcontent-%COMP%]   .metric-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--color-text-primary)}.metric[_ngcontent-%COMP%]   .metric-value.difficulty-medium[_ngcontent-%COMP%]{color:var(--color-warning-600)}.metric[_ngcontent-%COMP%]   .metric-value.difficulty-hard[_ngcontent-%COMP%]{color:var(--color-error-600)}"]})};export{D as TeacherStatistics};
