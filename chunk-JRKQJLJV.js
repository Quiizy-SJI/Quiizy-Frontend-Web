import{Ca as h,Ka as d,Z as r,a as s,db as c,eb as p,fb as u,na as o,rb as l,rc as v,sb as m,tb as f,wb as y}from"./chunk-T26DWB6S.js";var g=["canvas"],C=class a{type="bar";data;options;disableAnimations=!1;canvasRef;isReady=!1;chart=null;chartJsLoaded=!1;pendingUpdate=!1;updateDebounceId=null;resizeObserver=null;ngZone=r(h);async ngAfterViewInit(){await this.ensureChartJs(),this.chartJsLoaded=!0,this.renderChart(),this.setupResizeObserver()}ngOnChanges(e){if(!this.chartJsLoaded){this.pendingUpdate=!0;return}if(e.type&&!e.type.firstChange){this.renderChart();return}(e.data||e.options)&&this.debouncedUpdate()}ngOnDestroy(){this.updateDebounceId&&clearTimeout(this.updateDebounceId),this.resizeObserver&&this.resizeObserver.disconnect(),this.destroyChart()}destroyChart(){this.chart&&typeof this.chart.destroy=="function"&&this.chart.destroy(),this.chart=null}debouncedUpdate(){this.updateDebounceId&&clearTimeout(this.updateDebounceId),this.updateDebounceId=setTimeout(()=>{this.updateChart(),this.updateDebounceId=null},250)}updateChart(){if(!this.chart){this.renderChart();return}this.chart.data=this.deepClone(this.data);let e=this.getMergedOptions();Object.assign(this.chart.options,e),typeof this.chart.update=="function"&&this.chart.update(this.disableAnimations?"none":void 0)}async ensureChartJs(){window.Chart||await new Promise((t,n)=>{let i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/chart.js@4.4.5/dist/chart.umd.min.js",i.async=!0,i.onload=()=>t(),i.onerror=()=>n(new Error("Failed to load Chart.js")),document.head.appendChild(i)}).catch(()=>{})}getMergedOptions(){return s({responsive:!0,maintainAspectRatio:!1,animation:this.disableAnimations?!1:{duration:300,easing:"easeOutQuart"},resizeDelay:0,plugins:{legend:{display:!0}}},this.options)}renderChart(){let e=window,t=this.canvasRef.nativeElement,n=t.getContext("2d");if(!n||!e.Chart)return;this.destroyChart();let i=t.parentElement;i&&(t.width=i.clientWidth,t.height=i.clientHeight),this.ngZone.runOutsideAngular(()=>{this.chart=new e.Chart(n,{type:this.type,data:this.deepClone(this.data),options:this.getMergedOptions()})}),this.isReady=!0,this.pendingUpdate&&(this.pendingUpdate=!1,this.updateChart())}setupResizeObserver(){let e=this.canvasRef.nativeElement.parentElement;if(!e||typeof ResizeObserver>"u")return;let t=null;this.resizeObserver=new ResizeObserver(()=>{t&&clearTimeout(t),t=setTimeout(()=>{this.chart&&typeof this.chart.resize=="function"&&this.ngZone.runOutsideAngular(()=>{this.chart.resize()})},250)}),this.resizeObserver.observe(e)}deepClone(e){if(e===null||typeof e!="object")return e;try{return JSON.parse(JSON.stringify(e))}catch{return e}}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=d({type:a,selectors:[["ui-chart"]],viewQuery:function(t,n){if(t&1&&l(g,7),t&2){let i;m(i=f())&&(n.canvasRef=i.first)}},inputs:{type:"type",data:"data",options:"options",disableAnimations:"disableAnimations"},features:[o],decls:3,vars:2,consts:[["canvas",""],[1,"chart-host"]],template:function(t,n){t&1&&(c(0,"div",1),u(1,"canvas",null,0),p()),t&2&&y("chart-ready",n.isReady)},dependencies:[v],styles:[".chart-host[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;contain:layout style;opacity:0;transition:opacity .2s ease-out}.chart-host.chart-ready[_ngcontent-%COMP%]{opacity:1}.chart-host[_ngcontent-%COMP%] > canvas[_ngcontent-%COMP%]{position:absolute;inset:0;box-sizing:border-box;width:100%!important;height:100%!important;will-change:contents;image-rendering:auto}"],changeDetection:0})};export{C as a};
