import{a as G}from"./chunk-L7MJG26Q.js";import"./chunk-TEBYAPM2.js";import{a as z,f as R,h as N,l as B,n as H,o as q,q as j,t as U}from"./chunk-UUU7BI2K.js";import{c as L,f as O,n as W}from"./chunk-XIAE3S6L.js";import{a as F,b as V}from"./chunk-W67SSUM4.js";import"./chunk-23TWDL4C.js";import"./chunk-5XPIWXNK.js";import{$a as p,Ab as u,Db as f,Eb as h,Fb as C,Ka as A,Oa as k,Ob as T,Va as S,Wa as v,Wb as P,Z as D,ab as r,ba as M,bb as l,ca as w,cb as E,jb as b,lb as c,nb as m,nc as I,p as y,yb as s,za as d}from"./chunk-XVADYIPR.js";function K(a,i){if(a&1&&(r(0,"ui-alert",8),s(1),l()),a&2){let e=m();d(),u(" ",e.errorMessage," ")}}function Q(a,i){a&1&&(r(0,"div",10),E(1,"ui-spinner",24),l())}function X(a,i){if(a&1&&s(0),a&2){let e=m().$implicit;u(" ",e.user==null?null:e.user.name," ")}}function Y(a,i){if(a&1&&s(0),a&2){let e=m().$implicit;u(" ",e.user==null?null:e.user.surname," ")}}function Z(a,i){if(a&1&&s(0),a&2){let e=m().$implicit;u(" ",e.user==null?null:e.user.email," ")}}function $(a,i){if(a&1&&s(0),a&2){let e=m().$implicit;u(" ",e.user==null?null:e.user.login," ")}}function ee(a,i){if(a&1&&s(0),a&2){let e=m().$implicit;u(" ",e.speciality==null?null:e.speciality.name," ")}}function ie(a,i){if(a&1&&s(0),a&2){let e=m().$implicit;u(" ",e.updatedAt," ")}}function te(a,i){if(a&1){let e=b();r(0,"div",26)(1,"ui-button",27),c("clicked",function(){M(e);let o=m().$implicit,n=m(2);return w(n.openEdit(o))}),r(2,"mat-icon",28),s(3,"edit"),l(),s(4," Edit "),l(),r(5,"ui-button",29),c("clicked",function(){M(e);let o=m().$implicit,n=m(2);return w(n.delete(o))}),r(6,"mat-icon",28),s(7,"delete"),l(),s(8," Delete "),l()()}a&2&&(d(),p("iconLeft",!0),d(4),p("iconLeft",!0))}function ne(a,i){if(a&1&&S(0,X,1,1)(1,Y,1,1)(2,Z,1,1)(3,$,1,1)(4,ee,1,1)(5,ie,1,1)(6,te,9,2,"div",26),a&2){let e,t=i.column;v((e=t.key)==="name"?0:e==="surname"?1:e==="email"?2:e==="login"?3:e==="speciality"?4:e==="updatedAt"?5:e==="actions"?6:-1)}}function ae(a,i){if(a&1){let e=b();r(0,"ui-table",25),c("sortChange",function(o){M(e);let n=m();return w(n.onSortChange(o))})("pageChange",function(o){M(e);let n=m();return w(n.onPageChange(o))})("pageSizeChange",function(o){M(e);let n=m();return w(n.onPageSizeChange(o))}),k(1,ne,7,1,"ng-template",null,0,T),l()}if(a&2){let e=m();p("columns",e.columns)("data",e.rows)("showPagination",!0)("pagination",e.pagination)("sortColumn",e.sortColumn)("sortDirection",e.sortDirection)}}var J=class a{deanApi=D(G);cdr=D(P);isLoading=!1;errorMessage="";allRows=[];rows=[];specialities=[];pagination={page:1,pageSize:10,total:0,pageSizes:[5,10,25,50]};sortColumn=null;sortDirection=null;columns=[{key:"name",label:"Name",sortable:!0},{key:"surname",label:"Surname",sortable:!0},{key:"email",label:"Email",sortable:!0},{key:"login",label:"Login",sortable:!0},{key:"speciality",label:"Speciality",sortable:!0},{key:"updatedAt",label:"Updated",sortable:!0},{key:"actions",label:"Actions",width:"240px"}];isModalOpen=!1;modalMode="create";editingId=null;form={name:"",surname:"",email:"",login:"",password:"",specialityId:""};saveLoading=!1;async ngOnInit(){await this.load()}async load(){this.errorMessage="",this.isLoading=!0;try{this.allRows=await y(this.deanApi.listMiniAdmins()),this.specialities=await y(this.deanApi.listSpecialities()),this.pagination.total=this.allRows.length,this.pagination.page=1,this.updateDisplayedRows()}catch(i){this.errorMessage=i instanceof Error?i.message:"Failed to load Speciality Head."}finally{this.isLoading=!1,this.cdr.markForCheck()}}updateDisplayedRows(){let i=[...this.allRows];this.sortColumn&&this.sortDirection&&(i=i.sort((o,n)=>{let g,_;switch(this.sortColumn){case"name":g=o.user?.name??"",_=n.user?.name??"";break;case"surname":g=o.user?.surname??"",_=n.user?.surname??"";break;case"email":g=o.user?.email??"",_=n.user?.email??"";break;case"login":g=o.user?.login??"",_=n.user?.login??"";break;case"speciality":g=o.speciality?.name??"",_=n.speciality?.name??"";break;default:g=o[this.sortColumn]??"",_=n[this.sortColumn]??""}let x=String(g).localeCompare(String(_));return this.sortDirection==="asc"?x:-x}));let e=(this.pagination.page-1)*this.pagination.pageSize,t=e+this.pagination.pageSize;this.rows=i.slice(e,t)}onSortChange(i){this.sortColumn=i.column||null,this.sortDirection=i.direction,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageChange(i){this.pagination.page=i,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageSizeChange(i){this.pagination.pageSize=i,this.pagination.page=1,this.updateDisplayedRows(),this.cdr.markForCheck()}openCreate(){this.modalMode="create",this.editingId=null,this.form={name:"",surname:"",email:"",login:"",password:"",specialityId:""},this.isModalOpen=!0}openEdit(i){this.modalMode="edit",this.editingId=i.id,this.form={name:i.user?.name??"",surname:i.user?.surname??"",email:i.user?.email??"",login:i.user?.login??"",password:"",specialityId:i.speciality?.id??""},this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.saveLoading=!1}validateForm(){return this.form.name.trim()?this.form.surname.trim()?this.form.email.trim()?this.form.login.trim()?this.modalMode==="create"&&!this.form.password?(this.errorMessage="Password is required.",!1):!0:(this.errorMessage="Login is required.",!1):(this.errorMessage="Email is required.",!1):(this.errorMessage="Surname is required.",!1):(this.errorMessage="Name is required.",!1)}async save(){if(this.errorMessage="",!!this.validateForm()){this.saveLoading=!0;try{if(this.modalMode==="create")await y(this.deanApi.createMiniAdmin({name:this.form.name.trim(),surname:this.form.surname.trim(),email:this.form.email.trim(),login:this.form.login.trim(),password:this.form.password,specialityId:this.form.specialityId||void 0}));else if(this.editingId){let i={name:this.form.name.trim(),surname:this.form.surname.trim(),email:this.form.email.trim(),login:this.form.login.trim(),specialityId:String(this.form.specialityId)||null};this.form.password&&(i.password=this.form.password),await y(this.deanApi.updateMiniAdmin(this.editingId,i))}this.closeModal(),await this.load()}catch(i){this.errorMessage=i instanceof Error?i.message:"Save failed."}finally{this.saveLoading=!1,this.cdr.markForCheck()}}}async delete(i){this.errorMessage="";let e=`${i.user?.name??""} ${i.user?.surname??""}`.trim()||"this Speciality Head";if(confirm(`Delete ${e}?`))try{await y(this.deanApi.deleteMiniAdmin(i.id)),await this.load()}catch(o){this.errorMessage=o instanceof Error?o.message:"Delete failed."}}modalTitle(){return this.modalMode==="create"?"Create Speciality Head":"Edit Speciality Head"}specialityOptions(){let i=[{value:"",label:"-- No Speciality --"}];for(let e of this.specialities)i.push({value:e.id,label:e.name});return i}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=A({type:a,selectors:[["app-dean-mini-admins"]],decls:31,vars:17,consts:[["cell",""],[1,"page"],[1,"page__top"],[1,"page__title"],[1,"page__subtitle"],[1,"page__actions"],["variant","outline","color","neutral",3,"clicked","loading"],["variant","solid","color","primary",3,"clicked"],["type","danger","variant","outlined"],["title","Speciality Head",3,"hoverable"],[1,"page__loading"],[3,"columns","data","showPagination","pagination","sortColumn","sortDirection"],[3,"closed","isOpen","title","showFooter"],[1,"form"],[1,"grid-2"],["label","Name",3,"ngModelChange","ngModel"],["label","Surname",3,"ngModelChange","ngModel"],["label","Email","type","email",3,"ngModelChange","ngModel"],["label","Login",3,"ngModelChange","ngModel"],["label","Password","type","password","placeholder","Leave blank to keep current",3,"ngModelChange","ngModel"],["label","Speciality",3,"ngModelChange","options","ngModel","searchable"],["slot","footer",1,"modal-actions"],["variant","ghost","color","neutral",3,"clicked","disabled"],["variant","solid","color","primary",3,"clicked","loading"],["size","lg"],[3,"sortChange","pageChange","pageSizeChange","columns","data","showPagination","pagination","sortColumn","sortDirection"],[1,"row-actions"],["size","sm","variant","soft","color","neutral",3,"clicked","iconLeft"],["slot","icon-left"],["size","sm","variant","soft","color","danger",3,"clicked","iconLeft"]],template:function(e,t){e&1&&(r(0,"div",1)(1,"div",2)(2,"div")(3,"div",3),s(4,"Speciality Head Accounts"),l(),r(5,"div",4),s(6,"Create and manage speciality head accounts."),l()(),r(7,"div",5)(8,"ui-button",6),c("clicked",function(){return t.load()}),s(9," Refresh "),l(),r(10,"ui-button",7),c("clicked",function(){return t.openCreate()}),s(11," New Speciality Head "),l()()(),S(12,K,2,1,"ui-alert",8),r(13,"ui-card",9),S(14,Q,2,0,"div",10)(15,ae,3,6,"ui-table",11),l(),r(16,"ui-modal",12),c("closed",function(){return t.closeModal()}),r(17,"div",13)(18,"div",14)(19,"ui-input",15),C("ngModelChange",function(n){return h(t.form.name,n)||(t.form.name=n),n}),l(),r(20,"ui-input",16),C("ngModelChange",function(n){return h(t.form.surname,n)||(t.form.surname=n),n}),l()(),r(21,"div",14)(22,"ui-input",17),C("ngModelChange",function(n){return h(t.form.email,n)||(t.form.email=n),n}),l(),r(23,"ui-input",18),C("ngModelChange",function(n){return h(t.form.login,n)||(t.form.login=n),n}),l()(),r(24,"ui-input",19),C("ngModelChange",function(n){return h(t.form.password,n)||(t.form.password=n),n}),l(),r(25,"ui-select",20),C("ngModelChange",function(n){return h(t.form.specialityId,n)||(t.form.specialityId=n),n}),l()(),r(26,"div",21)(27,"ui-button",22),c("clicked",function(){return t.closeModal()}),s(28," Cancel "),l(),r(29,"ui-button",23),c("clicked",function(){return t.save()}),s(30," Save "),l()()()()),e&2&&(d(8),p("loading",t.isLoading),d(4),v(t.errorMessage?12:-1),d(),p("hoverable",!1),d(),v(t.isLoading?14:15),d(2),p("isOpen",t.isModalOpen)("title",t.modalTitle())("showFooter",!0),d(3),f("ngModel",t.form.name),d(),f("ngModel",t.form.surname),d(2),f("ngModel",t.form.email),d(),f("ngModel",t.form.login),d(),f("ngModel",t.form.password),d(),p("options",t.specialityOptions()),f("ngModel",t.form.specialityId),p("searchable",!0),d(2),p("disabled",t.saveLoading),d(2),p("loading",t.saveLoading))},dependencies:[I,W,L,O,V,F,B,j,z,H,R,N,q,U],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.page__top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:1rem;flex-wrap:wrap}.page__title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-primary)}.page__subtitle[_ngcontent-%COMP%]{color:var(--text-tertiary)}.page__actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.page__loading[_ngcontent-%COMP%]{padding:2rem 0;display:flex;justify-content:center}.row-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem}.grid-2[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem}"]})};export{J as DeanMiniAdmins};
