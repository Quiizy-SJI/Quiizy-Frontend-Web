<div class="teachers">
  <header class="teachers__header">
    <div class="teachers__title-section">
      <h1 class="teachers__title">Teacher Management</h1>
      <p class="teachers__subtitle">Create and manage teachers</p>
    </div>

    <div class="teachers__header-actions">
      <ui-button color="primary" variant="solid" size="sm" (clicked)="openCreate()">
        + Create Teacher
      </ui-button>

      <ui-select
        label="Select academic year"
        [options]="academicYearOptions()"
        [(ngModel)]="selectedAcademicYearId"
        (ngModelChange)="onAcademicYearChanged()"
        [searchable]="true"
      ></ui-select>

      <ui-select
        label="Select level"
        [options]="levelOptions()"
        [(ngModel)]="selectedLevel"
        (ngModelChange)="applyFilters()"
        [searchable]="true"
      ></ui-select>
    </div>
  </header>

  @if (errorMessage) {
    <ui-alert type="danger" variant="outlined">{{ errorMessage }}</ui-alert>
  }

  @if (infoMessage) {
    <ui-alert type="info" variant="outlined">{{ infoMessage }}</ui-alert>
  }

  <div class="teachers__toolbar">

    <ui-button color="warning" variant="soft" size="sm" (clicked)="importExcel()">
      Import Excel
    </ui-button>

    <ui-button color="secondary" variant="soft" size="sm" (clicked)="exportExcel()">
      Export Excel
    </ui-button>
  </div>

  <section class="teachers__grid">
    <ui-card variant="outlined" class="panel">
      <div class="panel__header">
        <div class="panel__title">Teachers Directory</div>
        <div class="panel__subtitle">View teachers and their course/class assignment footprint.</div>
      </div>

      <ui-table
        [columns]="columns"
        [data]="pagedRows"
        [loading]="loading"
        [searchable]="true"
        [selectable]="true"
        [rowClickable]="true"
        [showPagination]="true"
        [pagination]="pagination"
        trackByKey="id"
        (rowClick)="onRowClick($event.row)"
        (selectionChange)="onSelectionChange($event)"
        (pageChange)="onPageChange($event)"
        (pageSizeChange)="onPageSizeChange($event)"
      >
        <ng-template #cell let-row let-column="column">
          @switch (column.key) {
            @case ('actions') {
              <div class="table-actions">
                <ui-button size="sm" variant="soft" color="primary" (clicked)="selectRow(row)">View</ui-button>
                <ui-button size="sm" variant="soft" color="secondary" (clicked)="openEdit(row)">Edit</ui-button>
                <ui-button size="sm" variant="soft" color="danger" (clicked)="openDelete(row)">Delete</ui-button>
              </div>
            }
            @default {
              {{ row[column.key] }}
            }
          }
        </ng-template>

        <ng-template #empty>
          <div class="table-empty">No teachers found for this scope.</div>
        </ng-template>
      </ui-table>
    </ui-card>

    <ui-card variant="outlined" class="panel">
      <div class="panel__header">
        <div class="panel__title">Teacher Detail</div>
      </div>

      @if (!selectedRow) {
        <div class="detail-empty">Select a teacher to view details.</div>
      } @else {
        <div class="detail">
          <div class="detail__top">
            <div class="detail__name">{{ selectedRow.name }} {{ selectedRow.surname }}</div>
            <div class="detail__meta">
              <ui-badge color="primary" variant="subtle">Courses {{ selectedRow.assignedCourses }}</ui-badge>
              <ui-badge color="neutral" variant="subtle">Classes {{ selectedRow.assignedClasses }}</ui-badge>
            </div>
          </div>

          <div class="detail__fields">
            <div class="detail-field">
              <div class="detail-field__label">Email</div>
              <div class="detail-field__value">{{ selectedRow.email }}</div>
            </div>
            <div class="detail-field">
              <div class="detail-field__label">Levels</div>
              <div class="detail-field__value">{{ selectedRow.levels || '—' }}</div>
            </div>
            <div class="detail-field">
              <div class="detail-field__label">Academic years</div>
              <div class="detail-field__value">{{ selectedRow.academicYears || '—' }}</div>
            </div>
          </div>

          <div class="detail__actions">
            <ui-button color="secondary" variant="soft" size="sm" (clicked)="openEdit()">Edit Teacher</ui-button>
            <ui-button color="danger" variant="soft" size="sm" (clicked)="openDelete()">Delete Teacher</ui-button>
          </div>
        </div>
      }
    </ui-card>
  </section>

  <!-- Create modal -->
  <ui-modal [isOpen]="createOpen" title="Create Teacher" [showFooter]="true" (closed)="createOpen = false">
    <div class="modal-form">
      <ui-input label="Name" [(ngModel)]="draftName" placeholder="e.g., John"></ui-input>
      <ui-input label="Surname" [(ngModel)]="draftSurname" placeholder="e.g., Doe"></ui-input>
      <ui-input label="Email" [(ngModel)]="draftEmail" placeholder="e.g., john.doe@example.com"></ui-input>
      <ui-input label="Login" [(ngModel)]="draftLogin" placeholder="e.g., john.doe"></ui-input>
      <ui-input label="Password" type="password" [(ngModel)]="draftPassword" placeholder="Min 6 characters"></ui-input>
    </div>

    <div slot="footer" class="modal-actions">
      <ui-button variant="soft" color="neutral" (clicked)="createOpen = false">Cancel</ui-button>
      <ui-button color="primary" (clicked)="confirmCreate()">Create</ui-button>
    </div>
  </ui-modal>

  <!-- Edit modal -->
  <ui-modal [isOpen]="editOpen" title="Edit Teacher" [showFooter]="true" (closed)="editOpen = false">
    <div class="modal-form">
      <ui-input label="Name" [(ngModel)]="draftName"></ui-input>
      <ui-input label="Surname" [(ngModel)]="draftSurname"></ui-input>
      <ui-input label="Email" [(ngModel)]="draftEmail"></ui-input>
      <ui-input label="Login" [(ngModel)]="draftLogin"></ui-input>
      <ui-input label="Password (leave blank to keep)" type="password" [(ngModel)]="draftPassword"></ui-input>
    </div>

    <div slot="footer" class="modal-actions">
      <ui-button variant="soft" color="neutral" (clicked)="editOpen = false">Cancel</ui-button>
      <ui-button color="primary" (clicked)="confirmEdit()">Save</ui-button>
    </div>
  </ui-modal>

  <!-- Delete modal -->
  <ui-modal
    [isOpen]="deleteOpen"
    title="Delete Teacher"
    description="This will delete the teacher."
    [showFooter]="true"
    (closed)="deleteOpen = false"
  >
    <div class="delete-confirm">
      @if (selectedRow) {
        Are you sure you want to delete <strong>{{ selectedRow.name }} {{ selectedRow.surname }}</strong>?
      }
    </div>

    <div slot="footer" class="modal-actions">
      <ui-button variant="soft" color="neutral" (clicked)="deleteOpen = false">Cancel</ui-button>
      <ui-button color="danger" (clicked)="confirmDelete()">Delete</ui-button>
    </div>
  </ui-modal>
</div>
