<div class="page">
	<div class="page__top">
		<div>
			<div class="page__title">Specialities</div>
			<div class="page__subtitle">Create and manage specialities and assign heads.</div>
		</div>

		<div class="page__actions">
			<ui-button variant="outline" color="neutral" (clicked)="load()" [loading]="isLoading">Refresh</ui-button>
			<ui-button variant="solid" color="primary" (clicked)="openCreate()">New Speciality</ui-button>
		</div>
	</div>

	@if (errorMessage) {
		<ui-alert type="danger" variant="outlined">{{ errorMessage }}</ui-alert>
	}

	<ui-card title="Specialities" [hoverable]="false">
		@if (isLoading) {
			<div class="page__loading"><ui-spinner size="lg"></ui-spinner></div>
		} @else {
			<ui-table
				[columns]="columns"
				[data]="rows"
				[showPagination]="true"
				[pagination]="pagination"
				[sortColumn]="sortColumn"
				[sortDirection]="sortDirection"
				(sortChange)="onSortChange($event)"
				(pageChange)="onPageChange($event)"
				(pageSizeChange)="onPageSizeChange($event)"
			>
				<ng-template #cell let-row let-column="column">
					@switch (column.key) {
						@case ('name') { {{ row.name }} }
						@case ('head') { {{ row.head?.user ? (row.head.user.name + ' ' + row.head.user.surname) : '-' }} }
						@case ('updatedAt') { {{ row.updatedAt }} }
						@case ('actions') {
							<div class="row-actions">
								<ui-button size="sm" variant="ghost" color="neutral" (clicked)="openEdit(row)">Edit</ui-button>
								<ui-button size="sm" variant="ghost" color="primary" (clicked)="openAssign(row)" style="margin-left:8px">Assign Head</ui-button>
								<ui-button size="sm" variant="ghost" color="danger" (clicked)="delete(row)" style="margin-left:8px">Delete</ui-button>
							</div>
						}
						@default { {{ row[column.key] }} }
					}
				</ng-template>
			</ui-table>
		}
	</ui-card>

	<ui-modal [isOpen]="isModalOpen" [title]="modalTitle()" [showFooter]="true" (closed)="closeModal()">
		<div class="form">
			@if (modalMode === 'create' || modalMode === 'edit') {
				<ui-input label="Name" placeholder="e.g. Computer Science" [(ngModel)]="formName"></ui-input>
			} @else if (modalMode === 'assign') {
				<ui-select label="Speciality Head" [options]="miniAdminOptions()" [(ngModel)]="selectedHeadId" [searchable]="true"></ui-select>
			}
		</div>

		<div slot="footer" class="modal-actions">
			@if (modalMode === 'create' || modalMode === 'edit') {
				<ui-button variant="ghost" color="neutral" (clicked)="closeModal()" [disabled]="saveLoading">Cancel</ui-button>
				<ui-button variant="solid" color="primary" (clicked)="save()" [loading]="saveLoading">Save</ui-button>
			} @else {
				<ui-button variant="ghost" color="neutral" (clicked)="closeModal()" [disabled]="assignLoading">Cancel</ui-button>
				<ui-button variant="solid" color="primary" (clicked)="assign()" [loading]="assignLoading">Assign</ui-button>
			}
		</div>
	</ui-modal>
</div>
