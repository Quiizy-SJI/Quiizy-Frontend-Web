import{a as G}from"./chunk-FHBBJYU2.js";import"./chunk-FWCO3CJY.js";import{c as D,f as W,j as B}from"./chunk-AO6LNOWB.js";import"./chunk-SJBCNNOS.js";import{a as F,b as z}from"./chunk-2WUHN5CQ.js";import{a as j}from"./chunk-MAWX5T35.js";import{c as T,f as H,n as N,t as L,u as U}from"./chunk-XGVRFAFZ.js";import"./chunk-4BWE2P25.js";import"./chunk-LUIYB3PI.js";import"./chunk-LM6INHLT.js";import{$a as g,Ab as x,Db as C,Eb as w,Fb as y,Ka as I,Oa as Y,Pb as A,Va as v,Wa as b,Z as E,Za as O,_a as k,ab as s,ba as m,bb as n,ca as _,cb as V,jb as M,lb as p,nb as u,p as f,rc as P,xb as R,yb as l,za as c,zb as h}from"./chunk-3XB4H34J.js";var Q=(d,a)=>a.message;function X(d,a){if(d&1&&(s(0,"ui-alert",10),l(1),n()),d&2){let t=u();c(),x(" ",t.errorMessage," ")}}function Z(d,a){if(d&1&&(s(0,"ui-alert",11),l(1),n()),d&2){let t=u();c(),x(" ",t.infoMessage," ")}}function $(d,a){if(d&1){let t=M();s(0,"div",41)(1,"ui-button",42),p("clicked",function(){m(t);let i=u().$implicit,r=u();return _(r.selectRow(i))}),l(2,"View"),n(),s(3,"ui-button",43),p("clicked",function(){m(t);let i=u().$implicit,r=u();return _(r.openEdit(i))}),l(4,"Edit"),n(),s(5,"ui-button",44),p("clicked",function(){m(t);let i=u().$implicit,r=u();return _(r.openDelete(i))}),l(6,"Delete"),n()()}}function ee(d,a){if(d&1&&l(0),d&2){let t=u(),e=t.$implicit,i=t.column;x(" ",e[i.key]," ")}}function te(d,a){if(d&1&&v(0,$,7,0,"div",41)(1,ee,1,1),d&2){let t,e=a.column;b((t=e.key)==="actions"?0:1)}}function ie(d,a){d&1&&(s(0,"div",45),l(1,"No classes found for this scope."),n())}function ae(d,a){d&1&&(s(0,"div",22),l(1," Select a class to view details. "),n())}function se(d,a){if(d&1){let t=M();s(0,"div",23)(1,"div",46)(2,"div",47),l(3),n(),s(4,"div",48)(5,"ui-badge",49),l(6),n(),s(7,"ui-badge",50),l(8),n()()(),s(9,"div",51)(10,"div",52)(11,"div",53),l(12,"Students"),n(),s(13,"div",54),l(14),n()(),s(15,"div",52)(16,"div",53),l(17,"Teachers"),n(),s(18,"div",54),l(19),n()(),s(20,"div",52)(21,"div",53),l(22,"Subjects"),n(),s(23,"div",54),l(24),n()()(),s(25,"div",55)(26,"ui-button",15),p("clicked",function(){m(t);let i=u();return _(i.openEdit())}),l(27," Edit Class "),n(),s(28,"ui-button",56),p("clicked",function(){m(t);let i=u();return _(i.openDelete())}),l(29," Delete Class "),n()()()}if(d&2){let t=u();c(3),h(t.selectedRow.className),c(3),x("Level ",t.selectedRow.level||"\u2014"),c(2),h(t.selectedRow.academicYearLabel),c(6),h(t.selectedRow.students),c(5),h(t.selectedRow.teachers),c(5),h(t.selectedRow.subjects)}}function ne(d,a){if(d&1&&(s(0,"div",26),V(1,"span"),s(2,"div",57)(3,"div",58),l(4),n(),s(5,"div",59),l(6),n()()()),d&2){let t=a.$implicit,e=u();c(),R(e.activityDotClass(t.tone)),c(3),h(t.message),c(2),h(t.timeAgo)}}function re(d,a){if(d&1&&(l(0," Are you sure you want to delete "),s(1,"strong"),l(2),n(),l(3,"? ")),d&2){let t=u();c(2),h(t.selectedRow.className)}}var J=class d{headApi=E(G);academicYears=[];courses=[];classAcademicYears=[];rows=[];filteredRows=[];selectedAcademicYearId="";selectedRows=[];selectedRow=null;loading=!1;errorMessage="";infoMessage="";createOpen=!1;editOpen=!1;deleteOpen=!1;draftName="";draftLevel="";draftAcademicYearId="";activity=[];columns=[{key:"className",label:"Class",sortable:!0},{key:"level",label:"Level",sortable:!0,width:"90px",align:"center"},{key:"students",label:"Students",sortable:!0,width:"110px",align:"center"},{key:"teachers",label:"Teachers",sortable:!0,width:"110px",align:"center"},{key:"actions",label:"Actions",sortable:!1,width:"180px",align:"right"}];academicYearOptions(){let a=[{value:"",label:"Select academic year"}];for(let t of this.academicYears)a.push({value:t.id,label:`${t.start.split("-")[0]}\u2013${t.end.split("-")[0]}`});return a}activityDotClass(a){return`dot dot--${a}`}async ngOnInit(){await this.loadAll()}async loadAll(){this.loading=!0,this.errorMessage="";try{this.academicYears=await f(this.headApi.listAcademicYears()),this.selectedAcademicYearId||(this.selectedAcademicYearId=this.pickLatestAcademicYearId(this.academicYears)),await this.loadForAcademicYear(this.selectedAcademicYearId)}catch(a){this.errorMessage=a instanceof Error?a.message:"Failed to load classes."}finally{this.loading=!1}}async onAcademicYearChanged(){await this.loadForAcademicYear(this.selectedAcademicYearId)}async loadForAcademicYear(a){let t=a?.trim();if(!t){this.rows=[],this.filteredRows=[],this.selectedRow=null;return}this.loading=!0,this.errorMessage="";try{let[e,i]=await Promise.all([f(this.headApi.listCourses(t)),f(this.headApi.listClasses(t))]);this.courses=e,this.classAcademicYears=i,this.rows=this.mapRows(i),this.applyFilters(),!this.selectedRow&&this.filteredRows.length>0&&this.selectRow(this.filteredRows[0])}catch(e){this.errorMessage=e instanceof Error?e.message:"Failed to load classes."}finally{this.loading=!1}}pickLatestAcademicYearId(a){let t=i=>{if(typeof i!="string")return Number.NEGATIVE_INFINITY;let r=Date.parse(i);return Number.isFinite(r)?r:Number.NEGATIVE_INFINITY};return a.filter(i=>!!i?.id).map(i=>{let r=t(i.end),o=t(i.start);return{ay:i,score:r!==Number.NEGATIVE_INFINITY?r:o}}).sort((i,r)=>r.score-i.score)[0]?.ay?.id??""}getUser(){return JSON.parse(localStorage.getItem("currentUser")||"{}")}mapRows(a){let t=this.getUser()?.speciality?.name,e=new Map;for(let i of a){let r=i.class,o=i.academicYear;if(!i.id||!r?.id||!r.name||!o?.id)continue;let S=r?.speciality?.name;if(t&&S&&S!==t)continue;let K=this.countTeachersForClassAcademicYear(i.id),q=this.countSubjectsForClassAcademicYear(i.id);e.set(i.id,{id:i.id,classId:r.id,className:r.name,level:String(r.level??""),academicYearId:o.id,academicYearLabel:`${o.start.split("-")[0]}\u2013${o.end.split("-")[0]}`,students:0,teachers:K,subjects:q})}return Array.from(e.values()).sort((i,r)=>i.className.localeCompare(r.className))}countTeachersForClassAcademicYear(a){let t=new Set;for(let e of this.courses){if(e.classAcademicYear?.id!==a)continue;let i=e.teacher?.id;i&&t.add(i)}return t.size}countSubjectsForClassAcademicYear(a){let t=new Set;for(let e of this.courses){if(e.classAcademicYear?.id!==a)continue;let i=e.teachingUnit?.id;i&&t.add(i)}return t.size}applyFilters(){let a=this.selectedAcademicYearId?.trim();this.filteredRows=a?this.rows.filter(t=>t.academicYearId===a):this.rows.slice(),this.selectedRow&&!this.filteredRows.some(t=>t.id===this.selectedRow?.id)&&(this.selectedRow=this.filteredRows[0]??null)}onSelectionChange(a){this.selectedRows=a}onRowClick(a){this.selectRow(a)}selectRow(a){this.selectedRow=a}openCreate(){this.infoMessage="",this.draftName="",this.draftLevel="",this.draftAcademicYearId=this.selectedAcademicYearId||"",this.createOpen=!0}openEdit(a){let t=a??this.selectedRow;t&&(this.infoMessage="",this.draftName=t.className,this.draftLevel=t.level,this.draftAcademicYearId=t.academicYearId,this.editOpen=!0)}openDelete(a){let t=a??this.selectedRow;t&&(this.infoMessage="",this.selectedRow=t,this.deleteOpen=!0)}async confirmCreate(){if(!(!this.draftName.trim()||!this.draftAcademicYearId)){this.loading=!0,this.errorMessage="",this.infoMessage="";try{let a=await f(this.headApi.createClass({name:this.draftName.trim(),level:this.draftLevel?.trim()||void 0}));await f(this.headApi.createClassAcademicYear({classId:a.id,academicYearId:this.draftAcademicYearId})),this.createOpen=!1,await this.loadForAcademicYear(this.selectedAcademicYearId),this.infoMessage="Class created successfully."}catch(a){this.errorMessage=a instanceof Error?a.message:"Failed to create class."}finally{this.loading=!1}}}async confirmEdit(){if(this.selectedRow&&!(!this.draftName.trim()||!this.draftAcademicYearId)){this.loading=!0,this.errorMessage="",this.infoMessage="";try{await f(this.headApi.updateClass(this.selectedRow.classId,{name:this.draftName.trim(),level:this.draftLevel?.trim()||void 0})),this.selectedRow.academicYearId!==this.draftAcademicYearId&&await f(this.headApi.updateClassAcademicYear(this.selectedRow.id,{academicYearId:this.draftAcademicYearId})),this.editOpen=!1,await this.loadForAcademicYear(this.selectedAcademicYearId),this.infoMessage="Class updated successfully."}catch(a){this.errorMessage=a instanceof Error?a.message:"Failed to update class."}finally{this.loading=!1}}}async confirmDelete(){if(this.selectedRow){this.loading=!0,this.errorMessage="",this.infoMessage="";try{await f(this.headApi.deleteClassAcademicYear(this.selectedRow.id)),this.deleteOpen=!1,await this.loadForAcademicYear(this.selectedAcademicYearId),this.infoMessage="Class removed from the academic year."}catch(a){this.errorMessage=a instanceof Error?a.message:"Failed to delete class."}finally{this.loading=!1}}}async archiveSelected(){if(this.selectedRows.length!==0){this.loading=!0,this.errorMessage="",this.infoMessage="";try{await Promise.all(this.selectedRows.map(a=>f(this.headApi.deleteClassAcademicYear(a.id)))),this.selectedRows=[],await this.loadForAcademicYear(this.selectedAcademicYearId),this.infoMessage="Selected classes archived."}catch(a){this.errorMessage=a instanceof Error?a.message:"Failed to archive classes."}finally{this.loading=!1}}}importExcel(){this.infoMessage="Import Excel is not wired yet."}exportExcel(){this.infoMessage="Export Excel is not wired yet."}static \u0275fac=function(t){return new(t||d)};static \u0275cmp=I({type:d,selectors:[["app-head-classes"]],decls:74,vars:30,consts:[["cell",""],["empty",""],[1,"classes"],[1,"classes__header"],[1,"classes__title-section"],[1,"classes__title"],[1,"classes__subtitle"],[1,"classes__header-actions"],["color","primary","variant","solid","size","sm",3,"clicked"],["label","Select academic year",3,"ngModelChange","options","ngModel","searchable"],["type","danger","variant","outlined"],["type","info","variant","outlined"],[1,"classes__toolbar"],["color","success","variant","soft","size","sm",3,"clicked","disabled"],["color","warning","variant","soft","size","sm",3,"clicked"],["color","secondary","variant","soft","size","sm",3,"clicked"],[1,"classes__grid"],["variant","outlined",1,"panel"],[1,"panel__header"],[1,"panel__title"],[1,"panel__subtitle"],["trackByKey","id",3,"rowClick","selectionChange","columns","data","loading","searchable","selectable","rowClickable"],[1,"detail-empty"],[1,"detail"],[1,"classes__bottom"],[1,"activity-list"],[1,"activity-item"],["title","Create Class",3,"closed","isOpen","showFooter"],[1,"modal-form"],["label","Class name","placeholder","e.g., ING 4 ISI EN",3,"ngModelChange","ngModel"],["label","Level","placeholder","e.g., 4",3,"ngModelChange","ngModel"],["label","Academic year",3,"ngModelChange","options","ngModel","searchable"],["slot","footer",1,"modal-actions"],["variant","soft","color","neutral",3,"clicked"],["color","primary",3,"clicked"],["title","Edit Class",3,"closed","isOpen","showFooter"],["label","Class name",3,"ngModelChange","ngModel"],["label","Level",3,"ngModelChange","ngModel"],["title","Delete Class","description","This will remove the class from the list (UI only).",3,"closed","isOpen","showFooter"],[1,"delete-confirm"],["color","danger",3,"clicked"],[1,"table-actions"],["size","sm","variant","soft","color","primary",3,"clicked"],["size","sm","variant","soft","color","secondary",3,"clicked"],["size","sm","variant","soft","color","danger",3,"clicked"],[1,"table-empty"],[1,"detail__top"],[1,"detail__name"],[1,"detail__meta"],["color","primary","variant","subtle"],["color","neutral","variant","subtle"],[1,"detail__stats"],[1,"detail-stat"],[1,"detail-stat__label"],[1,"detail-stat__value"],[1,"detail__actions"],["color","danger","variant","soft","size","sm",3,"clicked"],[1,"activity-item__content"],[1,"activity-item__message"],[1,"activity-item__time"]],template:function(t,e){if(t&1){let i=M();s(0,"div",2)(1,"header",3)(2,"div",4)(3,"h1",5),l(4,"Class Management"),n(),s(5,"p",6),l(6,"Create, import classes"),n()(),s(7,"div",7)(8,"ui-button",8),p("clicked",function(){return m(i),_(e.openCreate())}),l(9," + Create Class "),n(),s(10,"ui-select",9),y("ngModelChange",function(o){return m(i),w(e.selectedAcademicYearId,o)||(e.selectedAcademicYearId=o),_(o)}),p("ngModelChange",function(){return m(i),_(e.onAcademicYearChanged())}),n()()(),v(11,X,2,1,"ui-alert",10),v(12,Z,2,1,"ui-alert",11),s(13,"div",12)(14,"ui-button",13),p("clicked",function(){return m(i),_(e.archiveSelected())}),l(15," Archive Selected "),n(),s(16,"ui-button",14),p("clicked",function(){return m(i),_(e.importExcel())}),l(17," Import Excel "),n(),s(18,"ui-button",15),p("clicked",function(){return m(i),_(e.exportExcel())}),l(19," Export Excel "),n()(),s(20,"section",16)(21,"ui-card",17)(22,"div",18)(23,"div",19),l(24,"Classes Overview"),n(),s(25,"div",20),l(26,"Teacher/class assignments are completed by specialty heads."),n()(),s(27,"ui-table",21),p("rowClick",function(o){return m(i),_(e.onRowClick(o.row))})("selectionChange",function(o){return m(i),_(e.onSelectionChange(o))}),Y(28,te,2,1,"ng-template",null,0,A)(30,ie,2,0,"ng-template",null,1,A),n()(),s(32,"ui-card",17)(33,"div",18)(34,"div",19),l(35,"Class Detail"),n()(),v(36,ae,2,0,"div",22)(37,se,30,6,"div",23),n()(),s(38,"section",24)(39,"ui-card",17)(40,"div",18)(41,"div",19),l(42,"Recent Activity"),n()(),s(43,"div",25),O(44,ne,7,4,"div",26,Q),n()()(),s(46,"ui-modal",27),p("closed",function(){return m(i),_(e.createOpen=!1)}),s(47,"div",28)(48,"ui-input",29),y("ngModelChange",function(o){return m(i),w(e.draftName,o)||(e.draftName=o),_(o)}),n(),s(49,"ui-input",30),y("ngModelChange",function(o){return m(i),w(e.draftLevel,o)||(e.draftLevel=o),_(o)}),n(),s(50,"ui-select",31),y("ngModelChange",function(o){return m(i),w(e.draftAcademicYearId,o)||(e.draftAcademicYearId=o),_(o)}),n()(),s(51,"div",32)(52,"ui-button",33),p("clicked",function(){return m(i),_(e.createOpen=!1)}),l(53,"Cancel"),n(),s(54,"ui-button",34),p("clicked",function(){return m(i),_(e.confirmCreate())}),l(55,"Create"),n()()(),s(56,"ui-modal",35),p("closed",function(){return m(i),_(e.editOpen=!1)}),s(57,"div",28)(58,"ui-input",36),y("ngModelChange",function(o){return m(i),w(e.draftName,o)||(e.draftName=o),_(o)}),n(),s(59,"ui-input",37),y("ngModelChange",function(o){return m(i),w(e.draftLevel,o)||(e.draftLevel=o),_(o)}),n(),s(60,"ui-select",31),y("ngModelChange",function(o){return m(i),w(e.draftAcademicYearId,o)||(e.draftAcademicYearId=o),_(o)}),n()(),s(61,"div",32)(62,"ui-button",33),p("clicked",function(){return m(i),_(e.editOpen=!1)}),l(63,"Cancel"),n(),s(64,"ui-button",34),p("clicked",function(){return m(i),_(e.confirmEdit())}),l(65,"Save"),n()()(),s(66,"ui-modal",38),p("closed",function(){return m(i),_(e.deleteOpen=!1)}),s(67,"div",39),v(68,re,4,1),n(),s(69,"div",32)(70,"ui-button",33),p("clicked",function(){return m(i),_(e.deleteOpen=!1)}),l(71,"Cancel"),n(),s(72,"ui-button",40),p("clicked",function(){return m(i),_(e.confirmDelete())}),l(73,"Delete"),n()()()()}t&2&&(c(10),g("options",e.academicYearOptions()),C("ngModel",e.selectedAcademicYearId),g("searchable",!0),c(),b(e.errorMessage?11:-1),c(),b(e.infoMessage?12:-1),c(2),g("disabled",e.selectedRows.length===0),c(13),g("columns",e.columns)("data",e.filteredRows)("loading",e.loading)("searchable",!1)("selectable",!0)("rowClickable",!0),c(9),b(e.selectedRow?37:36),c(8),k(e.activity),c(2),g("isOpen",e.createOpen)("showFooter",!0),c(2),C("ngModel",e.draftName),c(),C("ngModel",e.draftLevel),c(),g("options",e.academicYearOptions()),C("ngModel",e.draftAcademicYearId),g("searchable",!0),c(6),g("isOpen",e.editOpen)("showFooter",!0),c(2),C("ngModel",e.draftName),c(),C("ngModel",e.draftLevel),c(),g("options",e.academicYearOptions()),C("ngModel",e.draftAcademicYearId),g("searchable",!0),c(6),g("isOpen",e.deleteOpen)("showFooter",!0),c(2),b(e.selectedRow?68:-1))},dependencies:[P,N,T,H,z,U,F,W,j,L,B,D],styles:[".classes[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;padding:.5rem}.classes__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;flex-wrap:wrap}.classes__title-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.classes__title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:var(--text-primary);margin:0}.classes__subtitle[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-tertiary);margin:0}.classes__header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:flex-end;flex-wrap:wrap}.classes__toolbar[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.classes__grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.15fr .85fr;gap:1rem;align-items:start}@media (max-width: 1100px){.classes__grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.classes__bottom[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr}.panel[_ngcontent-%COMP%]{width:100%}.panel__header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;padding:.25rem 0 1rem}.panel__title[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:var(--text-primary)}.panel__subtitle[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--text-tertiary)}.table-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}.table-empty[_ngcontent-%COMP%]{padding:1rem 0;color:var(--text-tertiary);font-size:.875rem}.detail-empty[_ngcontent-%COMP%]{color:var(--text-tertiary);font-size:.875rem;padding:.5rem 0}.detail[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.detail__top[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.35rem}.detail__name[_ngcontent-%COMP%]{font-weight:700;color:var(--text-primary)}.detail__meta[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.detail__stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem}@media (max-width: 600px){.detail__stats[_ngcontent-%COMP%]{grid-template-columns:1fr}}.detail-stat[_ngcontent-%COMP%]{border:1px solid var(--border-subtle);background:var(--surface-raised);border-radius:12px;padding:.75rem}.detail-stat__label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-tertiary)}.detail-stat__value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-top:.25rem}.detail__actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.modal-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;width:100%}.delete-confirm[_ngcontent-%COMP%]{color:var(--text-primary)}.activity-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.activity-item[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:flex-start}.activity-item__content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.activity-item__message[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-primary)}.activity-item__time[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-tertiary)}.dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:999px;margin-top:.35rem;flex:0 0 10px}.dot--info[_ngcontent-%COMP%]{background:var(--color-info)}.dot--success[_ngcontent-%COMP%]{background:var(--color-success)}.dot--warning[_ngcontent-%COMP%]{background:var(--color-warning)}.dot--danger[_ngcontent-%COMP%]{background:var(--color-danger)}.dot--primary[_ngcontent-%COMP%]{background:var(--color-primary)}.dot--neutral[_ngcontent-%COMP%]{background:var(--text-tertiary)}.dot--secondary[_ngcontent-%COMP%]{background:var(--color-secondary)}.dot--accent[_ngcontent-%COMP%]{background:var(--color-accent)}"]})};export{J as HeadClasses};
