import{a as G}from"./chunk-WPWJA746.js";import"./chunk-TEBYAPM2.js";import{a as U,d as $,l as V,o as H,t as j}from"./chunk-UUU7BI2K.js";import"./chunk-XIAE3S6L.js";import{a as B,b as R}from"./chunk-W67SSUM4.js";import"./chunk-23TWDL4C.js";import{c as F,g as L}from"./chunk-5XPIWXNK.js";import{$a as h,Ab as u,Bb as N,Ka as k,Sb as v,Va as m,Wa as p,Wb as A,Xa as S,Z as f,Za as O,_a as w,a as D,ab as n,b as I,ba as E,bb as t,ca as P,cb as y,jb as z,la as C,lb as T,nb as d,nc as Q,p as M,wb as q,yb as o,za as a,zb as x}from"./chunk-XVADYIPR.js";function K(r,i){r&1&&(n(0,"div",11),y(1,"ui-spinner",13),n(2,"p"),o(3,"Loading quiz details..."),t()())}function Y(r,i){if(r&1&&(n(0,"ui-alert",12),o(1),t()),r&2){let e=d();a(),u(" ",e.errorMessage()," ")}}function W(r,i){if(r&1&&(n(0,"ui-badge",22),o(1),t()),r&2){let e=d(2);a(),u(" ",e.questionBreakdown().singleChoice," Single Choice ")}}function X(r,i){if(r&1&&(n(0,"ui-badge",23),o(1),t()),r&2){let e=d(2);a(),u(" ",e.questionBreakdown().multipleChoice," Multi-Select ")}}function Z(r,i){if(r&1&&(n(0,"ui-badge",24),o(1),t()),r&2){let e=d(2);a(),u(" ",e.questionBreakdown().trueFalse," True/False ")}}function ee(r,i){if(r&1&&(n(0,"ui-badge",25),o(1),t()),r&2){let e=d(2);a(),u(" ",e.questionBreakdown().openEnded," Essay ")}}function te(r,i){r&1&&(n(0,"mat-icon",48),o(1,"check_circle"),t())}function ne(r,i){if(r&1&&(n(0,"div",45)(1,"span",46),o(2),t(),n(3,"span",47),o(4),t(),m(5,te,2,0,"mat-icon",48),t()),r&2){let e=i.$implicit,s=i.$index,c=d(2).$implicit,_=d(2);q("correct",e===c.correctAnswer),a(2),x(_.getOptionLetter(s)),a(2),x(e),a(),p(e===c.correctAnswer?5:-1)}}function ie(r,i){if(r&1&&(n(0,"div",41),O(1,ne,6,5,"div",44,S),t()),r&2){let e=d().$implicit;a(),w(e.proposedAnswers)}}function oe(r,i){if(r&1&&(n(0,"div",42)(1,"span",49),o(2,"Answer:"),t(),n(3,"ui-badge",20),o(4),t()()),r&2){let e=d().$implicit;a(3),h("color",e.correctAnswer==="true"?"success":"danger"),a(),u(" ",e.correctAnswer==="true"?"True":"False"," ")}}function re(r,i){r&1&&(n(0,"div",43)(1,"mat-icon"),o(2,"edit_note"),t(),n(3,"span"),o(4,"Open-ended response (for sentiment analysis)"),t()())}function ae(r,i){if(r&1&&(n(0,"div",28)(1,"div",37)(2,"span",38),o(3),t(),n(4,"ui-badge",20),o(5),t(),n(6,"span",39),o(7),t()(),n(8,"p",40),o(9),t(),m(10,ie,3,0,"div",41),m(11,oe,5,2,"div",42),m(12,re,5,0,"div",43),t()),r&2){let e=i.$implicit,s=i.$index,c=d(2);a(3),u("Q",s+1),a(),h("color",c.getQuestionTypeColor(e.type)),a(),u(" ",c.getQuestionTypeLabel(e.type)," "),a(2),N("",e.markAllocation," ",e.markAllocation===1?"mark":"marks"),a(2),x(e.question),a(),p(e.type!=="OPEN_ENDED"&&e.proposedAnswers.length>0?10:-1),a(),p(e.type==="TRUE_FALSE"?11:-1),a(),p(e.type==="OPEN_ENDED"?12:-1)}}function se(r,i){if(r&1){let e=z();n(0,"ui-card",14)(1,"div",15)(2,"div",16)(3,"h3"),o(4,"Course & Type"),t(),n(5,"div",17)(6,"span",18),o(7,"Course"),t(),n(8,"span",19),o(9),t()(),n(10,"div",17)(11,"span",18),o(12,"Quiz Type"),t(),n(13,"ui-badge",20),o(14),t()(),n(15,"div",17)(16,"span",18),o(17,"Lectures Covered"),t(),n(18,"span",19),o(19),t()()(),n(20,"div",16)(21,"h3"),o(22,"Schedule"),t(),n(23,"div",17)(24,"span",18),o(25,"Date & Time"),t(),n(26,"span",19),o(27),t()(),n(28,"div",17)(29,"span",18),o(30,"Duration"),t(),n(31,"span",19),o(32),t()()(),n(33,"div",16)(34,"h3"),o(35,"Questions"),t(),n(36,"div",17)(37,"span",18),o(38,"Total Questions"),t(),n(39,"span",19),o(40),t()(),n(41,"div",17)(42,"span",18),o(43,"Total Marks"),t(),n(44,"span",19),o(45),t()(),n(46,"div",17)(47,"span",18),o(48,"Question Types"),t(),n(49,"div",21),m(50,W,2,1,"ui-badge",22),m(51,X,2,1,"ui-badge",23),m(52,Z,2,1,"ui-badge",24),m(53,ee,2,1,"ui-badge",25),t()()()()(),n(54,"ui-card",26)(55,"div",27),O(56,ae,13,9,"div",28,S),t()(),n(58,"ui-card",29)(59,"div",30)(60,"div",31)(61,"mat-icon"),o(62,"info"),t()(),n(63,"div",32)(64,"h3"),o(65,"Ready to Publish"),t(),n(66,"p"),o(67,"When you publish this quiz:"),t(),n(68,"ul")(69,"li"),o(70,"All students enrolled in the selected course will be automatically invited"),t(),n(71,"li"),o(72,"The quiz will become available at the scheduled date and time"),t(),n(73,"li"),o(74,"You can still edit questions before the quiz starts"),t()()()()(),n(75,"div",33)(76,"ui-button",34),T("clicked",function(){E(e);let c=d();return P(c.goBack())}),n(77,"mat-icon",35),o(78,"arrow_back"),t(),o(79," Back "),t(),n(80,"ui-button",36),T("clicked",function(){E(e);let c=d();return P(c.publishQuiz())}),n(81,"mat-icon",35),o(82,"publish"),t(),o(83),t()()}if(r&2){let e,s,c,_,g,l=d();a(9),x(l.courseName()),a(4),h("color",l.getTypeColor((e=l.step1Data())==null?null:e.type)),a(),u(" ",l.getTypeLabel((s=l.step1Data())==null?null:s.type)," "),a(5),x((c=l.step1Data())==null?null:c.lectures),a(8),x(l.formatDate((_=l.step1Data())==null?null:_.date)),a(5),u("",(g=l.step1Data())==null?null:g.durationMinutes," minutes"),a(8),x(l.questions().length),a(5),x(l.totalMarks()),a(5),p(l.questionBreakdown().singleChoice>0?50:-1),a(),p(l.questionBreakdown().multipleChoice>0?51:-1),a(),p(l.questionBreakdown().trueFalse>0?52:-1),a(),p(l.questionBreakdown().openEnded>0?53:-1),a(3),w(l.questions()),a(24),h("loading",l.isPublishing())("disabled",l.isPublishing()),a(3),u(" ",l.isPublishing()?"Publishing...":"Publish Quiz"," ")}}var J=class r{router=f(F);teacherApi=f(G);cdr=f(A);isLoading=C(!1);isPublishing=C(!1);errorMessage=C("");step1Data=C(null);step2Data=C(null);courses=C([]);questions=v(()=>this.step2Data()?.questions??[]);totalMarks=v(()=>this.questions().reduce((i,e)=>i+e.markAllocation,0));courseName=v(()=>{let i=this.step1Data()?.courseId;if(!i)return"Not selected";let e=this.courses().find(_=>_.id===i);if(!e)return"Unknown Course";let s=e.teachingUnit?.name??"",c=e.classAcademicYear?.class?.name??"";return c?`${s} \u2014 ${c}`:s});questionBreakdown=v(()=>{let i=this.questions();return{singleChoice:i.filter(e=>e.type==="SINGLE_CHOICE").length,multipleChoice:i.filter(e=>e.type==="MULTIPLE_CHOICE").length,trueFalse:i.filter(e=>e.type==="TRUE_FALSE").length,openEnded:i.filter(e=>e.type==="OPEN_ENDED").length}});async ngOnInit(){this.loadFormData(),await this.loadCourses()}loadFormData(){let i=sessionStorage.getItem("examFormStep1");if(i)try{this.step1Data.set(JSON.parse(i))}catch{this.errorMessage.set("Failed to load quiz details. Please go back and try again.")}let e=sessionStorage.getItem("examFormStep2");if(e)try{this.step2Data.set(JSON.parse(e))}catch{this.errorMessage.set("Failed to load questions. Please go back and try again.")}(!this.step1Data()||!this.step2Data())&&this.errorMessage.set("Missing quiz data. Please start from the beginning.")}async loadCourses(){try{let i=await M(this.teacherApi.getMyCourses());this.courses.set(i)}catch{}}getTypeLabel(i){return i?{CA:"Continuous Assessment",MEDIAN:"Midterm",FINAL:"Final Exam",MOCK:"Mock Test"}[i]||i:"Unknown"}getTypeColor(i){return i&&{CA:"info",MEDIAN:"warning",FINAL:"danger",MOCK:"secondary"}[i]||"neutral"}getQuestionTypeLabel(i){return{SINGLE_CHOICE:"Single Choice",MULTIPLE_CHOICE:"Multi-Select",TRUE_FALSE:"True/False",OPEN_ENDED:"Essay"}[i]||i}getQuestionTypeColor(i){return{SINGLE_CHOICE:"primary",MULTIPLE_CHOICE:"secondary",TRUE_FALSE:"info",OPEN_ENDED:"warning"}[i]||"neutral"}getOptionLetter(i){return String.fromCharCode(65+i)}formatDate(i){if(!i)return"Not set";try{return new Date(i).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return i}}goBack(){this.router.navigate(["/teacher/create-exam/step2"])}async publishQuiz(){let i=this.step1Data(),e=this.step2Data();if(!i||!e||e.questions.length===0){alert("Missing quiz data. Please go back and complete all steps.");return}this.isPublishing.set(!0);try{let c=this.courses().find(g=>g.id===i.courseId)?.teachingUnit?.id??i.teachingUnitId??"";if(!c){alert("Course must have a teaching unit for question categorization."),this.isPublishing.set(!1);return}let _={courseId:String(i.courseId),type:String(i.type),lectures:Number(i.lectures),date:String(i.date),durationMinutes:Number(i.durationMinutes),newQuestions:e.questions.map(g=>{let l=g.type==="OPEN_ENDED";return I(D({question:String(g.question).trim(),type:String(g.type),difficultyLevel:"LEVEL_3",teachingUnitId:c},l?{}:{proposedAnswers:g.proposedAnswers.map(b=>String(b).trim()).filter(b=>b.length>0),correctAnswer:String(g.correctAnswer).trim()}),{markAllocation:Number(g.markAllocation)})}),publishImmediately:!0};console.log("Publishing quiz with payload:",JSON.stringify(_,null,2)),await M(this.teacherApi.createQuiz(_)),sessionStorage.removeItem("examFormStep1"),sessionStorage.removeItem("examFormStep2"),alert("Quiz published successfully! Students have been invited."),this.router.navigate(["/teacher/exam-manager"])}catch(s){console.error("Failed to publish quiz:",s);let c=s instanceof Error?s.message:"Failed to publish quiz. Please try again.";alert(c)}finally{this.isPublishing.set(!1)}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-teacher-create-exam-step3"]],decls:39,vars:3,consts:[[1,"review-publish"],[1,"page-header"],["variant","elevated",1,"stepper-card"],[1,"progress-stepper"],[1,"step","completed"],[1,"step-number"],[1,"step-info"],[1,"step-title"],[1,"step-desc"],[1,"step-connector","completed"],[1,"step","active"],[1,"loading-state"],["variant","filled","color","danger"],["size","lg"],["variant","elevated","title","Quiz Summary"],[1,"summary-grid"],[1,"summary-section"],[1,"summary-item"],[1,"label"],[1,"value"],["size","sm",3,"color"],[1,"type-breakdown"],["color","primary","size","sm"],["color","secondary","size","sm"],["color","info","size","sm"],["color","warning","size","sm"],["variant","elevated","title","Questions Preview"],[1,"questions-preview"],[1,"question-preview-item"],["variant","elevated"],[1,"publish-notice"],[1,"notice-icon"],[1,"notice-content"],[1,"form-actions"],["variant","outline","color","neutral",3,"clicked"],["slot","icon-left"],["variant","solid","color","primary",3,"clicked","loading","disabled"],[1,"question-preview-header"],[1,"question-number"],[1,"question-marks"],[1,"question-text"],[1,"answer-preview"],[1,"tf-answer"],[1,"open-ended-note"],[1,"answer-option",3,"correct"],[1,"answer-option"],[1,"option-letter"],[1,"option-text"],[1,"correct-icon"],[1,"answer-label"]],template:function(e,s){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),o(3,"Review & Publish"),t(),n(4,"p"),o(5,"Review your quiz details before publishing. Students will be automatically invited."),t()(),n(6,"ui-card",2)(7,"div",3)(8,"div",4)(9,"div",5)(10,"mat-icon"),o(11,"check"),t()(),n(12,"div",6)(13,"span",7),o(14,"Quiz Details"),t(),n(15,"span",8),o(16,"Course, type & schedule"),t()()(),y(17,"div",9),n(18,"div",4)(19,"div",5)(20,"mat-icon"),o(21,"check"),t()(),n(22,"div",6)(23,"span",7),o(24,"Add Questions"),t(),n(25,"span",8),o(26,"Build your quiz"),t()()(),y(27,"div",9),n(28,"div",10)(29,"div",5),o(30,"3"),t(),n(31,"div",6)(32,"span",7),o(33,"Review & Publish"),t(),n(34,"span",8),o(35,"Final review"),t()()()()(),m(36,K,4,0,"div",11),m(37,Y,2,1,"ui-alert",12),m(38,se,84,15),t()),e&2&&(a(36),p(s.isLoading()?36:-1),a(),p(s.errorMessage()?37:-1),a(),p(!s.isLoading()&&!s.errorMessage()?38:-1))},dependencies:[Q,R,B,L,V,U,$,j,H],styles:[".review-publish[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;margin-bottom:.5rem;color:var(--color-text-primary)}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:.938rem}.stepper-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.progress-stepper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:1rem 0}@media (max-width: 640px){.progress-stepper[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:50%;background:var(--color-background-muted);color:var(--color-text-secondary);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.938rem}.step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--color-primary-600);color:#fff}.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--color-success-600);color:#fff}.step[_ngcontent-%COMP%]   .step-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.step[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text-primary)}.step.active[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{color:var(--color-primary-600);font-weight:600}.step[_ngcontent-%COMP%]   .step-desc[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-text-tertiary)}.step-connector[_ngcontent-%COMP%]{flex:1;height:2px;background:var(--color-border-default);margin:0 1.5rem;max-width:80px}.step-connector.completed[_ngcontent-%COMP%]{background:var(--color-success-600)}@media (max-width: 640px){.step-connector[_ngcontent-%COMP%]{display:none}}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;color:var(--color-text-secondary)}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:1rem}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:2rem}.summary-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--color-text-secondary);text-transform:uppercase;letter-spacing:.05em;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid var(--color-border-subtle)}.summary-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;margin-bottom:.875rem}.summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.813rem;color:var(--color-text-tertiary)}.summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1rem;color:var(--color-text-primary);font-weight:500}.type-breakdown[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.25rem}.questions-preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.question-preview-item[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--color-border-default);border-radius:8px;background:var(--surface-base)}.question-preview-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem}.question-preview-header[_ngcontent-%COMP%]   .question-number[_ngcontent-%COMP%]{font-weight:600;color:var(--color-primary-600)}.question-preview-header[_ngcontent-%COMP%]   .question-marks[_ngcontent-%COMP%]{margin-left:auto;font-size:.813rem;color:var(--color-text-secondary)}.question-text[_ngcontent-%COMP%]{font-size:.938rem;color:var(--color-text-primary);line-height:1.5;margin-bottom:.75rem}.answer-preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.375rem}.answer-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border:1px solid var(--color-border-subtle);border-radius:6px;font-size:.875rem}.answer-option.correct[_ngcontent-%COMP%]{background:var(--color-success-50);border-color:var(--color-success-300)}.answer-option[_ngcontent-%COMP%]   .option-letter[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text-secondary);min-width:1.25rem}.answer-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]{flex:1;color:var(--color-text-primary)}.answer-option[_ngcontent-%COMP%]   .correct-icon[_ngcontent-%COMP%]{color:var(--color-success-600);font-size:1rem;width:1rem;height:1rem}.tf-answer[_ngcontent-%COMP%], .open-ended-note[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem}.tf-answer[_ngcontent-%COMP%]   .answer-label[_ngcontent-%COMP%], .open-ended-note[_ngcontent-%COMP%]   .answer-label[_ngcontent-%COMP%]{color:var(--color-text-secondary)}.open-ended-note[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-style:italic}.open-ended-note[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.125rem;width:1.125rem;height:1.125rem}.publish-notice[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:.5rem}.publish-notice[_ngcontent-%COMP%]   .notice-icon[_ngcontent-%COMP%]{flex-shrink:0}.publish-notice[_ngcontent-%COMP%]   .notice-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.5rem;width:1.5rem;height:1.5rem;color:var(--color-info-500)}.publish-notice[_ngcontent-%COMP%]   .notice-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--color-text-primary);margin-bottom:.5rem}.publish-notice[_ngcontent-%COMP%]   .notice-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary);margin-bottom:.5rem}.publish-notice[_ngcontent-%COMP%]   .notice-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1.25rem}.publish-notice[_ngcontent-%COMP%]   .notice-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary);margin-bottom:.375rem;line-height:1.4}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid var(--color-border-subtle)}[_nghost-%COMP%]     ui-card{margin-bottom:1.5rem}[_nghost-%COMP%]     .card__body{padding:1.5rem}"]})};export{J as TeacherCreateExamStep3};
