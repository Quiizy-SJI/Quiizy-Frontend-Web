import{a as U}from"./chunk-YPRXJ25I.js";import"./chunk-LSE4QE4L.js";import{g as N,j as H,n as q}from"./chunk-ZPZWYV2O.js";import"./chunk-DX4RU2C5.js";import{a as R,b as j}from"./chunk-C546SSYU.js";import{a as B}from"./chunk-KSJF27MU.js";import{c as V,f as O,n as I,t as W,u as $}from"./chunk-3OLBZRES.js";import{a as z,b as F}from"./chunk-YL2QS7YU.js";import"./chunk-HQOA22C6.js";import"./chunk-3WAO3F22.js";import{$a as m,Ab as u,Db as M,Eb as v,Fb as D,Ka as k,Oa as Y,Pb as T,Va as f,Wa as h,Xb as P,Z as S,ab as r,ba as _,bb as s,ca as g,cb as E,jb as w,lb as p,nb as l,p as C,rc as L,yb as d,za as c}from"./chunk-T26DWB6S.js";function J(a,t){if(a&1&&(r(0,"ui-alert",8),d(1),s()),a&2){let e=l();c(),u(" ",e.errorMessage," ")}}function K(a,t){a&1&&(r(0,"div",10),E(1,"ui-spinner",20),s())}function Q(a,t){if(a&1&&d(0),a&2){let e=l().$implicit;u(" ",e.start," ")}}function X(a,t){if(a&1&&d(0),a&2){let e=l().$implicit;u(" ",e.end," ")}}function Z(a,t){if(a&1&&d(0),a&2){let e=l().$implicit,i=l(2);u(" ",i.classesCount(e)," ")}}function ee(a,t){if(a&1&&d(0),a&2){let e=l().$implicit;u(" ",e.updatedAt," ")}}function te(a,t){if(a&1){let e=w();r(0,"div",22)(1,"ui-button",23),p("clicked",function(){_(e);let n=l().$implicit,o=l(2);return g(o.openEdit(n))}),r(2,"mat-icon",24),d(3,"edit"),s(),d(4," Edit "),s(),r(5,"ui-button",25),p("clicked",function(){_(e);let n=l().$implicit,o=l(2);return g(o.delete(n))}),r(6,"mat-icon",24),d(7,"delete"),s(),d(8," Delete "),s()()}a&2&&(c(),m("iconLeft",!0),c(4),m("iconLeft",!0))}function ie(a,t){if(a&1&&f(0,Q,1,1)(1,X,1,1)(2,Z,1,1)(3,ee,1,1)(4,te,9,2,"div",22),a&2){let e,i=t.column;h((e=i.key)==="start"?0:e==="end"?1:e==="classesCount"?2:e==="updatedAt"?3:e==="actions"?4:-1)}}function ae(a,t){if(a&1){let e=w();r(0,"ui-table",21),p("sortChange",function(n){_(e);let o=l();return g(o.onSortChange(n))})("pageChange",function(n){_(e);let o=l();return g(o.onPageChange(n))})("pageSizeChange",function(n){_(e);let o=l();return g(o.onPageSizeChange(n))}),Y(1,ie,5,1,"ng-template",null,0,T),s()}if(a&2){let e=l();m("columns",e.columns)("data",e.rows)("showHeader",!1)("loading",!1)("showPagination",!0)("pagination",e.pagination)("sortColumn",e.sortColumn)("sortDirection",e.sortDirection)}}function ne(a,t){if(a&1){let e=w();r(0,"ui-checkbox",26),D("ngModelChange",function(n){_(e);let o=l();return v(o.formCloneClasses,n)||(o.formCloneClasses=n),g(n)}),s()}if(a&2){let e=l();M("ngModel",e.formCloneClasses)}}var G=class a{deanApi=S(U);cdr=S(P);isLoading=!1;errorMessage="";allRows=[];rows=[];pagination={page:1,pageSize:10,total:0,pageSizes:[5,10,25,50]};sortColumn=null;sortDirection=null;columns=[{key:"start",label:"Start",sortable:!0},{key:"end",label:"End",sortable:!0},{key:"classesCount",label:"Classes",sortable:!0},{key:"updatedAt",label:"Updated",sortable:!0},{key:"actions",label:"Actions",width:"220px"}];isModalOpen=!1;modalMode="create";editingId=null;formStart="";formEnd="";formCloneClasses=!0;saveLoading=!1;async ngOnInit(){await this.load()}async load(){this.errorMessage="",this.isLoading=!0;try{this.allRows=await C(this.deanApi.listAcademicYears()),this.pagination.total=this.allRows.length,this.pagination.page=1,this.updateDisplayedRows()}catch(t){this.errorMessage=t instanceof Error?t.message:"Failed to load academic years."}finally{this.isLoading=!1,this.cdr.markForCheck()}}updateDisplayedRows(){let t=[...this.allRows];this.sortColumn&&this.sortDirection&&(t=t.sort((n,o)=>{let y,x;if(this.sortColumn==="classesCount"){y=this.classesCount(n),x=this.classesCount(o);let A=y-x;return this.sortDirection==="asc"?A:-A}y=n[this.sortColumn]??"",x=o[this.sortColumn]??"";let b=String(y).localeCompare(String(x));return this.sortDirection==="asc"?b:-b}));let e=(this.pagination.page-1)*this.pagination.pageSize,i=e+this.pagination.pageSize;this.rows=t.slice(e,i)}onSortChange(t){this.sortColumn=t.column||null,this.sortDirection=t.direction,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageChange(t){this.pagination.page=t,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageSizeChange(t){this.pagination.pageSize=t,this.pagination.page=1,this.updateDisplayedRows(),this.cdr.markForCheck()}openCreate(){this.modalMode="create",this.editingId=null,this.formStart="",this.formEnd="",this.formCloneClasses=!0,this.isModalOpen=!0}openEdit(t){this.modalMode="edit",this.editingId=t.id,this.formStart=t.start,this.formEnd=t.end,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.saveLoading=!1}async save(){if(this.errorMessage="",!this.formStart.trim()||!this.formEnd.trim()){this.errorMessage="Start and end are required.";return}this.saveLoading=!0;try{this.modalMode==="create"?await C(this.deanApi.createAcademicYear({start:this.formStart.trim(),end:this.formEnd.trim(),cloneClassesFromLatest:this.formCloneClasses})):this.editingId&&await C(this.deanApi.updateAcademicYear(this.editingId,{start:this.formStart.trim(),end:this.formEnd.trim()})),this.closeModal(),await this.load()}catch(t){this.errorMessage=t instanceof Error?t.message:"Save failed."}finally{this.saveLoading=!1,this.cdr.markForCheck()}}async delete(t){if(this.errorMessage="",!!confirm(`Delete academic year ${t.start}\u2013${t.end}?`))try{await C(this.deanApi.deleteAcademicYear(t.id)),await this.load()}catch(i){this.errorMessage=i instanceof Error?i.message:"Delete failed."}}classesCount(t){return t.classAcademicYears?.length??0}modalTitle(){return this.modalMode==="create"?"Create Academic Year":"Edit Academic Year"}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-dean-academic-years"]],decls:26,vars:12,consts:[["cell",""],[1,"page"],[1,"page__top"],[1,"page__title"],[1,"page__subtitle"],[1,"page__actions"],["variant","outline","color","neutral",3,"clicked","loading"],["variant","solid","color","primary",3,"clicked"],["type","danger","variant","outlined"],["title","Academic Years","subtitle","",3,"hoverable"],[1,"page__loading"],[3,"columns","data","showHeader","loading","showPagination","pagination","sortColumn","sortDirection"],[3,"closed","isOpen","title","showFooter"],[1,"form"],["label","Start","placeholder","e.g. 2024",3,"ngModelChange","ngModel"],["label","End","placeholder","e.g. 2025",3,"ngModelChange","ngModel"],["label","Clone classes from latest year","color","primary",3,"ngModel"],["slot","footer",1,"modal-actions"],["variant","ghost","color","neutral",3,"clicked","disabled"],["variant","solid","color","primary",3,"clicked","loading"],["size","lg"],[3,"sortChange","pageChange","pageSizeChange","columns","data","showHeader","loading","showPagination","pagination","sortColumn","sortDirection"],[1,"row-actions"],["size","sm","variant","soft","color","neutral",3,"clicked","iconLeft"],["slot","icon-left"],["size","sm","variant","soft","color","danger",3,"clicked","iconLeft"],["label","Clone classes from latest year","color","primary",3,"ngModelChange","ngModel"]],template:function(e,i){e&1&&(r(0,"div",1)(1,"div",2)(2,"div")(3,"div",3),d(4,"Academic Years"),s(),r(5,"div",4),d(6,"Create and manage academic years."),s()(),r(7,"div",5)(8,"ui-button",6),p("clicked",function(){return i.load()}),d(9," Refresh "),s(),r(10,"ui-button",7),p("clicked",function(){return i.openCreate()}),d(11," New Academic Year "),s()()(),f(12,J,2,1,"ui-alert",8),r(13,"ui-card",9),f(14,K,2,0,"div",10)(15,ae,3,8,"ui-table",11),s(),r(16,"ui-modal",12),p("closed",function(){return i.closeModal()}),r(17,"div",13)(18,"ui-input",14),D("ngModelChange",function(o){return v(i.formStart,o)||(i.formStart=o),o}),s(),r(19,"ui-input",15),D("ngModelChange",function(o){return v(i.formEnd,o)||(i.formEnd=o),o}),s(),f(20,ne,1,1,"ui-checkbox",16),s(),r(21,"div",17)(22,"ui-button",18),p("clicked",function(){return i.closeModal()}),d(23," Cancel "),s(),r(24,"ui-button",19),p("clicked",function(){return i.save()}),d(25," Save "),s()()()()),e&2&&(c(8),m("loading",i.isLoading),c(4),h(i.errorMessage?12:-1),c(),m("hoverable",!1),c(),h(i.isLoading?14:15),c(2),m("isOpen",i.isModalOpen)("title",i.modalTitle())("showFooter",!0),c(2),M("ngModel",i.formStart),c(),M("ngModel",i.formEnd),c(),h(i.modalMode==="create"?20:-1),c(2),m("disabled",i.saveLoading),c(2),m("loading",i.saveLoading))},dependencies:[L,I,V,O,F,z,j,$,R,B,W,N,H,q],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.page__top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:1rem;flex-wrap:wrap}.page__title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-primary)}.page__subtitle[_ngcontent-%COMP%]{color:var(--text-tertiary)}.page__actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.page__loading[_ngcontent-%COMP%]{padding:2rem 0;display:flex;justify-content:center}.row-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem}"]})};export{G as DeanAcademicYears};
