import{a as $}from"./chunk-2FZ36ZB7.js";import"./chunk-SPLO5XSZ.js";import{a as z,f as I,l as R,n as A,o as F,q as j,t as W}from"./chunk-UUU7BI2K.js";import{c as P,f as N,n as O}from"./chunk-XIAE3S6L.js";import{a as L,b as V}from"./chunk-W67SSUM4.js";import"./chunk-23TWDL4C.js";import"./chunk-5XPIWXNK.js";import{$a as m,Ab as C,Db as D,Eb as b,Fb as S,Ka as w,Oa as x,Ob as k,Va as h,Wa as f,Wb as U,Z as v,ab as o,ba as g,bb as r,ca as _,cb as M,jb as T,lb as p,nb as d,nc as E,p as u,yb as l,za as c}from"./chunk-XVADYIPR.js";function H(n,e){if(n&1&&(o(0,"ui-alert",8),l(1),r()),n&2){let t=d();c(),C(" ",t.errorMessage," ")}}function J(n,e){n&1&&(o(0,"div",10),M(1,"ui-spinner",18),r())}function K(n,e){if(n&1&&l(0),n&2){let t=d().$implicit;C(" ",t.name," ")}}function Q(n,e){if(n&1&&l(0),n&2){let t=d().$implicit;C(" ",t.updatedAt," ")}}function X(n,e){if(n&1){let t=T();o(0,"div",20)(1,"ui-button",21),p("clicked",function(){g(t);let a=d().$implicit,s=d(2);return _(s.openEdit(a))}),o(2,"mat-icon",22),l(3,"edit"),r(),l(4," Edit "),r(),o(5,"ui-button",23),p("clicked",function(){g(t);let a=d().$implicit,s=d(2);return _(s.delete(a))}),o(6,"mat-icon",22),l(7,"delete"),r(),l(8," Delete "),r()()}n&2&&(c(),m("iconLeft",!0),c(4),m("iconLeft",!0))}function Y(n,e){if(n&1&&h(0,K,1,1)(1,Q,1,1)(2,X,9,2,"div",20),n&2){let t,i=e.column;f((t=i.key)==="name"?0:t==="updatedAt"?1:t==="actions"?2:-1)}}function Z(n,e){if(n&1){let t=T();o(0,"ui-table",19),p("sortChange",function(a){g(t);let s=d();return _(s.onSortChange(a))})("pageChange",function(a){g(t);let s=d();return _(s.onPageChange(a))})("pageSizeChange",function(a){g(t);let s=d();return _(s.onPageSizeChange(a))}),x(1,Y,3,1,"ng-template",null,0,k),r()}if(n&2){let t=d();m("columns",t.columns)("data",t.rows)("showPagination",!0)("pagination",t.pagination)("sortColumn",t.sortColumn)("sortDirection",t.sortDirection)}}var B=class n{deanApi=v($);cdr=v(U);isLoading=!1;errorMessage="";allRows=[];rows=[];pagination={page:1,pageSize:10,total:0,pageSizes:[5,10,25,50]};sortColumn=null;sortDirection=null;columns=[{key:"name",label:"Name",sortable:!0},{key:"updatedAt",label:"Updated",sortable:!0},{key:"actions",label:"Actions",width:"220px"}];isModalOpen=!1;modalMode="create";editingId=null;formName="";saveLoading=!1;async ngOnInit(){await this.load()}async load(){this.errorMessage="",this.isLoading=!0;try{this.allRows=await u(this.deanApi.listTeachingUnits()),this.pagination.total=this.allRows.length,this.pagination.page=1,this.updateDisplayedRows()}catch(e){this.errorMessage=e instanceof Error?e.message:"Failed to load teaching units."}finally{this.isLoading=!1,this.cdr.markForCheck()}}updateDisplayedRows(){let e=[...this.allRows];this.sortColumn&&this.sortDirection&&(e=e.sort((a,s)=>{let q=a[this.sortColumn]??"",G=s[this.sortColumn]??"",y=String(q).localeCompare(String(G));return this.sortDirection==="asc"?y:-y}));let t=(this.pagination.page-1)*this.pagination.pageSize,i=t+this.pagination.pageSize;this.rows=e.slice(t,i)}onSortChange(e){this.sortColumn=e.column||null,this.sortDirection=e.direction,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageChange(e){this.pagination.page=e,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageSizeChange(e){this.pagination.pageSize=e,this.pagination.page=1,this.updateDisplayedRows(),this.cdr.markForCheck()}openCreate(){this.modalMode="create",this.editingId=null,this.formName="",this.isModalOpen=!0}openEdit(e){this.modalMode="edit",this.editingId=e.id,this.formName=e.name??"",this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.saveLoading=!1}async save(){if(this.errorMessage="",!this.formName.trim()){this.errorMessage="Name is required.";return}this.saveLoading=!0;try{this.modalMode==="create"?await u(this.deanApi.createTeachingUnit({name:this.formName.trim()})):this.editingId&&await u(this.deanApi.updateTeachingUnit(this.editingId,{name:this.formName.trim()})),this.closeModal(),await this.load()}catch(e){this.errorMessage=e instanceof Error?e.message:"Save failed."}finally{this.saveLoading=!1,this.cdr.markForCheck()}}async delete(e){if(this.errorMessage="",!!confirm(`Delete teaching unit ${e.name}?`))try{await u(this.deanApi.deleteTeachingUnit(e.id)),await this.load()}catch(i){this.errorMessage=i instanceof Error?i.message:"Delete failed."}}modalTitle(){return this.modalMode==="create"?"Create Teaching Unit":"Edit Teaching Unit"}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=w({type:n,selectors:[["app-dean-teaching-units"]],decls:24,vars:10,consts:[["cell",""],[1,"page"],[1,"page__top"],[1,"page__title"],[1,"page__subtitle"],[1,"page__actions"],["variant","outline","color","neutral",3,"clicked","loading"],["variant","solid","color","primary",3,"clicked"],["type","danger","variant","outlined"],["title","Teaching Units",3,"hoverable"],[1,"page__loading"],[3,"columns","data","showPagination","pagination","sortColumn","sortDirection"],[3,"closed","isOpen","title","showFooter"],[1,"form"],["label","Name","placeholder","e.g. Data Structures",3,"ngModelChange","ngModel"],["slot","footer",1,"modal-actions"],["variant","ghost","color","neutral",3,"clicked","disabled"],["variant","solid","color","primary",3,"clicked","loading"],["size","lg"],[3,"sortChange","pageChange","pageSizeChange","columns","data","showPagination","pagination","sortColumn","sortDirection"],[1,"row-actions"],["size","sm","variant","soft","color","neutral",3,"clicked","iconLeft"],["slot","icon-left"],["size","sm","variant","soft","color","danger",3,"clicked","iconLeft"]],template:function(t,i){t&1&&(o(0,"div",1)(1,"div",2)(2,"div")(3,"div",3),l(4,"Teaching Units"),r(),o(5,"div",4),l(6,"Create and manage teaching units."),r()(),o(7,"div",5)(8,"ui-button",6),p("clicked",function(){return i.load()}),l(9," Refresh "),r(),o(10,"ui-button",7),p("clicked",function(){return i.openCreate()}),l(11," New Teaching Unit "),r()()(),h(12,H,2,1,"ui-alert",8),o(13,"ui-card",9),h(14,J,2,0,"div",10)(15,Z,3,6,"ui-table",11),r(),o(16,"ui-modal",12),p("closed",function(){return i.closeModal()}),o(17,"div",13)(18,"ui-input",14),S("ngModelChange",function(s){return b(i.formName,s)||(i.formName=s),s}),r()(),o(19,"div",15)(20,"ui-button",16),p("clicked",function(){return i.closeModal()}),l(21," Cancel "),r(),o(22,"ui-button",17),p("clicked",function(){return i.save()}),l(23," Save "),r()()()()),t&2&&(c(8),m("loading",i.isLoading),c(4),f(i.errorMessage?12:-1),c(),m("hoverable",!1),c(),f(i.isLoading?14:15),c(2),m("isOpen",i.isModalOpen)("title",i.modalTitle())("showFooter",!0),c(2),D("ngModel",i.formName),c(2),m("disabled",i.saveLoading),c(2),m("loading",i.saveLoading))},dependencies:[E,O,P,N,V,L,R,j,z,A,I,F,W],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.page__top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:1rem;flex-wrap:wrap}.page__title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-primary)}.page__subtitle[_ngcontent-%COMP%]{color:var(--text-tertiary)}.page__actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.page__loading[_ngcontent-%COMP%]{padding:2rem 0;display:flex;justify-content:center}.row-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem}"]})};export{B as DeanTeachingUnits};
