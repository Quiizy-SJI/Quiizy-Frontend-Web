import{a as G}from"./chunk-JP3RDASN.js";import"./chunk-O6YQIL4L.js";import{i as j,j as U,n as $}from"./chunk-AO6LNOWB.js";import"./chunk-SJBCNNOS.js";import{a as N,b as B}from"./chunk-2WUHN5CQ.js";import{a as q}from"./chunk-MAWX5T35.js";import{c as I,f as V,n as z,t as W,u as Y}from"./chunk-XGVRFAFZ.js";import{a as A,b as R}from"./chunk-4BWE2P25.js";import"./chunk-LUIYB3PI.js";import"./chunk-LM6INHLT.js";import{$a as m,Ab as u,Db as C,Eb as x,Fb as v,Ka as S,Oa as k,Pb as L,Va as h,Wa as y,Xb as O,Z as T,ab as r,ba as _,bb as l,ca as g,cb as P,jb as E,lb as c,nb as p,p as f,rc as F,yb as s,za as d}from"./chunk-3XB4H34J.js";function J(n,e){if(n&1&&(r(0,"ui-alert",8),s(1),l()),n&2){let t=p();d(),u(" ",t.errorMessage," ")}}function K(n,e){n&1&&(r(0,"div",10),P(1,"ui-spinner",20),l())}function Q(n,e){if(n&1&&s(0),n&2){let t=p().$implicit;u(" ",t.name," ")}}function X(n,e){if(n&1&&s(0),n&2){let t=p().$implicit;u(" ",t.description," ")}}function Z(n,e){if(n&1&&s(0),n&2){let t=p().$implicit;u(" ",t.active?"Yes":"No"," ")}}function ee(n,e){if(n&1&&s(0),n&2){let t=p().$implicit;u(" ",t.updatedAt," ")}}function te(n,e){if(n&1){let t=E();r(0,"div",22)(1,"ui-button",23),c("clicked",function(){_(t);let o=p().$implicit,a=p(2);return g(a.openEdit(o))}),r(2,"mat-icon",24),s(3,"edit"),l(),s(4," Edit "),l(),r(5,"ui-button",25),c("clicked",function(){_(t);let o=p().$implicit,a=p(2);return g(a.delete(o))}),r(6,"mat-icon",24),s(7,"delete"),l(),s(8," Delete "),l()()}n&2&&(d(),m("iconLeft",!0),d(4),m("iconLeft",!0))}function ie(n,e){if(n&1&&h(0,Q,1,1)(1,X,1,1)(2,Z,1,1)(3,ee,1,1)(4,te,9,2,"div",22),n&2){let t,i=e.column;y((t=i.key)==="name"?0:t==="description"?1:t==="active"?2:t==="updatedAt"?3:t==="actions"?4:-1)}}function ne(n,e){if(n&1){let t=E();r(0,"ui-table",21),c("sortChange",function(o){_(t);let a=p();return g(a.onSortChange(o))})("pageChange",function(o){_(t);let a=p();return g(a.onPageChange(o))})("pageSizeChange",function(o){_(t);let a=p();return g(a.onPageSizeChange(o))}),k(1,ie,5,1,"ng-template",null,0,L),l()}if(n&2){let t=p();m("columns",t.columns)("data",t.rows)("showPagination",!0)("pagination",t.pagination)("sortColumn",t.sortColumn)("sortDirection",t.sortDirection)}}var H=class n{deanApi=T(G);cdr=T(O);isLoading=!1;errorMessage="";allRows=[];rows=[];pagination={page:1,pageSize:10,total:0,pageSizes:[5,10,25,50]};sortColumn=null;sortDirection=null;columns=[{key:"name",label:"Name",sortable:!0},{key:"description",label:"Description"},{key:"active",label:"Active",sortable:!0},{key:"updatedAt",label:"Updated",sortable:!0},{key:"actions",label:"Actions",width:"220px"}];isModalOpen=!1;modalMode="create";editingId=null;form={name:"",description:"",active:!0};saveLoading=!1;async ngOnInit(){await this.load()}async load(){this.errorMessage="",this.isLoading=!0;try{this.allRows=await f(this.deanApi.listExamTypes()),this.pagination.total=this.allRows.length,this.pagination.page=1,this.updateDisplayedRows()}catch(e){this.errorMessage=e instanceof Error?e.message:"Failed to load exam types."}finally{this.isLoading=!1,this.cdr.markForCheck()}}updateDisplayedRows(){let e=[...this.allRows];this.sortColumn&&this.sortDirection&&(e=e.sort((o,a)=>{let w=o[this.sortColumn]??"",M=a[this.sortColumn]??"";if(this.sortColumn==="active"){let b=(w?1:0)-(M?1:0);return this.sortDirection==="asc"?b:-b}let D=String(w).localeCompare(String(M));return this.sortDirection==="asc"?D:-D}));let t=(this.pagination.page-1)*this.pagination.pageSize,i=t+this.pagination.pageSize;this.rows=e.slice(t,i)}onSortChange(e){this.sortColumn=e.column||null,this.sortDirection=e.direction,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageChange(e){this.pagination.page=e,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageSizeChange(e){this.pagination.pageSize=e,this.pagination.page=1,this.updateDisplayedRows(),this.cdr.markForCheck()}openCreate(){this.modalMode="create",this.editingId=null,this.form={name:"",description:"",active:!0},this.isModalOpen=!0}openEdit(e){this.modalMode="edit",this.editingId=e.id,this.form={name:e.name??"",description:e.description??"",active:!!e.active},this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.saveLoading=!1}validateForm(){return this.form.name.trim()?!0:(this.errorMessage="Name is required.",!1)}async save(){if(this.errorMessage="",!!this.validateForm()){this.saveLoading=!0;try{let e={name:this.form.name.trim(),description:this.form.description.trim()?this.form.description.trim():void 0,active:this.form.active};this.modalMode==="create"?await f(this.deanApi.createExamType(e)):this.editingId&&await f(this.deanApi.updateExamType(this.editingId,e)),this.closeModal(),await this.load()}catch(e){this.errorMessage=e instanceof Error?e.message:"Save failed."}finally{this.saveLoading=!1,this.cdr.markForCheck()}}}async delete(e){if(this.errorMessage="",!!confirm(`Delete exam type ${e.name}?`))try{await f(this.deanApi.deleteExamType(e.id)),await this.load()}catch(i){this.errorMessage=i instanceof Error?i.message:"Delete failed."}}modalTitle(){return this.modalMode==="create"?"Create Exam Type":"Edit Exam Type"}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-dean-exam-types"]],decls:26,vars:12,consts:[["cell",""],[1,"page"],[1,"page__top"],[1,"page__title"],[1,"page__subtitle"],[1,"page__actions"],["variant","outline","color","neutral",3,"clicked","loading"],["variant","solid","color","primary",3,"clicked"],["type","danger","variant","outlined"],["title","Exam Types",3,"hoverable"],[1,"page__loading"],[3,"columns","data","showPagination","pagination","sortColumn","sortDirection"],[3,"closed","isOpen","title","showFooter"],[1,"form"],["label","Name","placeholder","e.g. Midterm",3,"ngModelChange","ngModel"],["label","Description","placeholder","Optional",3,"ngModelChange","ngModel"],["label","Active","color","primary",3,"ngModelChange","ngModel"],["slot","footer",1,"modal-actions"],["variant","ghost","color","neutral",3,"clicked","disabled"],["variant","solid","color","primary",3,"clicked","loading"],["size","lg"],[3,"sortChange","pageChange","pageSizeChange","columns","data","showPagination","pagination","sortColumn","sortDirection"],[1,"row-actions"],["size","sm","variant","soft","color","neutral",3,"clicked","iconLeft"],["slot","icon-left"],["size","sm","variant","soft","color","danger",3,"clicked","iconLeft"]],template:function(t,i){t&1&&(r(0,"div",1)(1,"div",2)(2,"div")(3,"div",3),s(4,"Exam Types"),l(),r(5,"div",4),s(6,"Create and manage exam types."),l()(),r(7,"div",5)(8,"ui-button",6),c("clicked",function(){return i.load()}),s(9," Refresh "),l(),r(10,"ui-button",7),c("clicked",function(){return i.openCreate()}),s(11," New Exam Type "),l()()(),h(12,J,2,1,"ui-alert",8),r(13,"ui-card",9),h(14,K,2,0,"div",10)(15,ne,3,6,"ui-table",11),l(),r(16,"ui-modal",12),c("closed",function(){return i.closeModal()}),r(17,"div",13)(18,"ui-input",14),v("ngModelChange",function(a){return x(i.form.name,a)||(i.form.name=a),a}),l(),r(19,"ui-input",15),v("ngModelChange",function(a){return x(i.form.description,a)||(i.form.description=a),a}),l(),r(20,"ui-toggle",16),v("ngModelChange",function(a){return x(i.form.active,a)||(i.form.active=a),a}),l()(),r(21,"div",17)(22,"ui-button",18),c("clicked",function(){return i.closeModal()}),s(23," Cancel "),l(),r(24,"ui-button",19),c("clicked",function(){return i.save()}),s(25," Save "),l()()()()),t&2&&(d(8),m("loading",i.isLoading),d(4),y(i.errorMessage?12:-1),d(),m("hoverable",!1),d(),y(i.isLoading?14:15),d(2),m("isOpen",i.isModalOpen)("title",i.modalTitle())("showFooter",!0),d(2),C("ngModel",i.form.name),d(),C("ngModel",i.form.description),d(),C("ngModel",i.form.active),d(2),m("disabled",i.saveLoading),d(2),m("loading",i.saveLoading))},dependencies:[F,z,I,V,R,A,B,Y,N,q,W,j,U,$],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.page__top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:1rem;flex-wrap:wrap}.page__title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-primary)}.page__subtitle[_ngcontent-%COMP%]{color:var(--text-tertiary)}.page__actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.page__loading[_ngcontent-%COMP%]{padding:2rem 0;display:flex;justify-content:center}.row-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem}"]})};export{H as DeanExamTypes};
