import{a as J}from"./chunk-KXSQJ5PU.js";import"./chunk-MD74L3HJ.js";import"./chunk-FWCO3CJY.js";import{f as W,j as U,n as G}from"./chunk-AO6LNOWB.js";import"./chunk-SJBCNNOS.js";import{a as F,b as j}from"./chunk-2WUHN5CQ.js";import{a as B}from"./chunk-MAWX5T35.js";import{c as O,f as N,n as H,t as $,u as q}from"./chunk-XGVRFAFZ.js";import{a as z,b as R}from"./chunk-4BWE2P25.js";import"./chunk-LUIYB3PI.js";import"./chunk-LM6INHLT.js";import{$a as p,Ab as x,Db as M,Eb as v,Fb as D,Ka as k,Oa as E,Pb as A,Va as f,Wa as C,Xb as I,Z as w,ab as s,ba as m,bb as l,ca as _,cb as T,jb as h,lb as u,nb as o,p as g,rc as P,vc as L,yb as d,za as c,zb as V}from"./chunk-3XB4H34J.js";function Q(i,t){if(i&1&&(s(0,"ui-alert",8),d(1),l()),i&2){let e=o();c(),V(e.errorMessage)}}function X(i,t){i&1&&(s(0,"div",10),T(1,"ui-spinner",17),l())}function Y(i,t){if(i&1&&d(0),i&2){let e=o().$implicit;x(" ",e.name," ")}}function Z(i,t){if(i&1&&d(0),i&2){let e=o().$implicit;x(" ",e.head!=null&&e.head.user?e.head.user.name+" "+e.head.user.surname:"-"," ")}}function ee(i,t){if(i&1&&d(0),i&2){let e=o().$implicit;x(" ",e.updatedAt," ")}}function te(i,t){if(i&1){let e=h();s(0,"div",19)(1,"ui-button",20),u("clicked",function(){m(e);let n=o().$implicit,r=o(2);return _(r.openEdit(n))}),s(2,"mat-icon",21),d(3,"edit"),l(),d(4," Edit "),l(),s(5,"ui-button",22),u("clicked",function(){m(e);let n=o().$implicit,r=o(2);return _(r.openAssign(n))}),s(6,"mat-icon",21),d(7,"person_add"),l(),d(8," Assign Head "),l(),s(9,"ui-button",23),u("clicked",function(){m(e);let n=o().$implicit,r=o(2);return _(r.delete(n))}),s(10,"mat-icon",21),d(11,"delete"),l(),d(12," Delete "),l()()}i&2&&(c(),p("iconLeft",!0),c(4),p("iconLeft",!0),c(4),p("iconLeft",!0))}function ie(i,t){if(i&1&&d(0),i&2){let e=o(),a=e.$implicit,n=e.column;x(" ",a[n.key]," ")}}function ne(i,t){if(i&1&&f(0,Y,1,1)(1,Z,1,1)(2,ee,1,1)(3,te,13,3,"div",19)(4,ie,1,1),i&2){let e,a=t.column;C((e=a.key)==="name"?0:e==="head"?1:e==="updatedAt"?2:e==="actions"?3:4)}}function ae(i,t){if(i&1){let e=h();s(0,"ui-table",18),u("sortChange",function(n){m(e);let r=o();return _(r.onSortChange(n))})("pageChange",function(n){m(e);let r=o();return _(r.onPageChange(n))})("pageSizeChange",function(n){m(e);let r=o();return _(r.onPageSizeChange(n))}),E(1,ne,5,1,"ng-template",null,0,A),l()}if(i&2){let e=o();p("columns",e.columns)("data",e.rows)("showPagination",!0)("pagination",e.pagination)("sortColumn",e.sortColumn)("sortDirection",e.sortDirection)}}function oe(i,t){if(i&1){let e=h();s(0,"ui-input",24),D("ngModelChange",function(n){m(e);let r=o();return v(r.formName,n)||(r.formName=n),_(n)}),l()}if(i&2){let e=o();M("ngModel",e.formName)}}function se(i,t){if(i&1){let e=h();s(0,"ui-select",25),D("ngModelChange",function(n){m(e);let r=o();return v(r.selectedHeadId,n)||(r.selectedHeadId=n),_(n)}),l()}if(i&2){let e=o();p("options",e.miniAdminOptions()),M("ngModel",e.selectedHeadId),p("searchable",!0)}}function le(i,t){if(i&1){let e=h();s(0,"ui-button",26),u("clicked",function(){m(e);let n=o();return _(n.closeModal())}),d(1,"Cancel"),l(),s(2,"ui-button",27),u("clicked",function(){m(e);let n=o();return _(n.save())}),d(3,"Save"),l()}if(i&2){let e=o();p("disabled",e.saveLoading),c(2),p("loading",e.saveLoading)}}function re(i,t){if(i&1){let e=h();s(0,"ui-button",26),u("clicked",function(){m(e);let n=o();return _(n.closeModal())}),d(1,"Cancel"),l(),s(2,"ui-button",27),u("clicked",function(){m(e);let n=o();return _(n.assign())}),d(3,"Assign"),l()}if(i&2){let e=o();p("disabled",e.assignLoading),c(2),p("loading",e.assignLoading)}}var K=class i{deanApi=w(J);cdr=w(I);isLoading=!1;errorMessage="";allRows=[];rows=[];miniAdmins=[];pagination={page:1,pageSize:10,total:0,pageSizes:[5,10,25,50]};sortColumn=null;sortDirection=null;columns=[{key:"name",label:"Name",sortable:!0},{key:"head",label:"Head",sortable:!0},{key:"updatedAt",label:"Updated",sortable:!0},{key:"actions",label:"Actions",width:"280px"}];isModalOpen=!1;modalMode="create";editingId=null;formName="";saveLoading=!1;selectedHeadId=null;assignLoading=!1;async ngOnInit(){await this.load()}async load(){this.errorMessage="",this.isLoading=!0;try{this.allRows=await g(this.deanApi.listSpecialities()),this.miniAdmins=await g(this.deanApi.listMiniAdmins()),this.pagination.total=this.allRows.length,this.pagination.page=1,this.updateDisplayedRows()}catch(t){this.errorMessage=t instanceof Error?t.message:"Failed to load specialities."}finally{this.isLoading=!1,this.cdr.markForCheck()}}updateDisplayedRows(){let t=[...this.allRows];this.sortColumn&&this.sortDirection&&(t=t.sort((n,r)=>{let S,y;this.sortColumn==="head"?(S=n.head?.user?`${n.head.user.name} ${n.head.user.surname}`:"",y=r.head?.user?`${r.head.user.name} ${r.head.user.surname}`:""):(S=n[this.sortColumn]??"",y=r[this.sortColumn]??"");let b=String(S).localeCompare(String(y));return this.sortDirection==="asc"?b:-b}));let e=(this.pagination.page-1)*this.pagination.pageSize,a=e+this.pagination.pageSize;this.rows=t.slice(e,a)}onSortChange(t){this.sortColumn=t.column||null,this.sortDirection=t.direction,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageChange(t){this.pagination.page=t,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageSizeChange(t){this.pagination.pageSize=t,this.pagination.page=1,this.updateDisplayedRows(),this.cdr.markForCheck()}openCreate(){this.modalMode="create",this.editingId=null,this.formName="",this.isModalOpen=!0}openEdit(t){this.modalMode="edit",this.editingId=t.id,this.formName=t.name??"",this.isModalOpen=!0}openAssign(t){this.modalMode="assign",this.editingId=t.id,this.selectedHeadId=t.head?.id??null,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.saveLoading=!1,this.assignLoading=!1}async save(){if(this.errorMessage="",!this.formName.trim()){this.errorMessage="Name is required.";return}this.saveLoading=!0;try{this.modalMode==="create"?await g(this.deanApi.createSpeciality({name:this.formName.trim()})):this.modalMode==="edit"&&this.editingId&&await g(this.deanApi.updateSpeciality(this.editingId,{name:this.formName.trim()})),this.closeModal(),await this.load()}catch(t){this.errorMessage=t instanceof Error?t.message:"Save failed."}finally{this.saveLoading=!1,this.cdr.markForCheck()}}async assign(){if(this.errorMessage="",!!this.editingId){this.assignLoading=!0;try{let t=this.selectedHeadId&&this.selectedHeadId!==""?this.selectedHeadId:null;await g(this.deanApi.assignSpecialityHead(this.editingId,String(t))),this.closeModal(),await this.load()}catch(t){if(t instanceof L){let e=typeof t.error?.message=="string"?t.error.message:t.message;this.errorMessage=e||"Assign failed."}else t instanceof Error?this.errorMessage=t.message:this.errorMessage="Assign failed."}finally{this.assignLoading=!1,this.cdr.markForCheck()}}}async delete(t){if(this.errorMessage="",!!confirm(`Delete speciality ${t.name}?`))try{await g(this.deanApi.deleteSpeciality(t.id)),await this.load()}catch(a){this.errorMessage=a instanceof Error?a.message:"Delete failed."}}modalTitle(){return this.modalMode==="create"?"Create Speciality":this.modalMode==="edit"?"Edit Speciality":"Assign Speciality Head"}miniAdminOptions(){let t=[{value:null,label:"-- Unassign --"}];for(let e of this.miniAdmins)t.push({value:e.id,label:`${e.user.name} ${e.user.surname} (${e.user.email})`});return t}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-dean-specialities"]],decls:23,vars:9,consts:[["cell",""],[1,"page"],[1,"page__top"],[1,"page__title"],[1,"page__subtitle"],[1,"page__actions"],["variant","outline","color","neutral",3,"clicked","loading"],["variant","solid","color","primary",3,"clicked"],["type","danger","variant","outlined"],["title","Specialities",3,"hoverable"],[1,"page__loading"],[3,"columns","data","showPagination","pagination","sortColumn","sortDirection"],[3,"closed","isOpen","title","showFooter"],[1,"form"],["label","Name","placeholder","e.g. Computer Science",3,"ngModel"],["label","Speciality Head",3,"options","ngModel","searchable"],["slot","footer",1,"modal-actions"],["size","lg"],[3,"sortChange","pageChange","pageSizeChange","columns","data","showPagination","pagination","sortColumn","sortDirection"],[1,"row-actions"],["size","sm","variant","soft","color","neutral",3,"clicked","iconLeft"],["slot","icon-left"],["size","sm","variant","soft","color","primary",3,"clicked","iconLeft"],["size","sm","variant","soft","color","danger",3,"clicked","iconLeft"],["label","Name","placeholder","e.g. Computer Science",3,"ngModelChange","ngModel"],["label","Speciality Head",3,"ngModelChange","options","ngModel","searchable"],["variant","ghost","color","neutral",3,"clicked","disabled"],["variant","solid","color","primary",3,"clicked","loading"]],template:function(e,a){e&1&&(s(0,"div",1)(1,"div",2)(2,"div")(3,"div",3),d(4,"Specialities"),l(),s(5,"div",4),d(6,"Create and manage specialities and assign heads."),l()(),s(7,"div",5)(8,"ui-button",6),u("clicked",function(){return a.load()}),d(9,"Refresh"),l(),s(10,"ui-button",7),u("clicked",function(){return a.openCreate()}),d(11,"New Speciality"),l()()(),f(12,Q,2,1,"ui-alert",8),s(13,"ui-card",9),f(14,X,2,0,"div",10)(15,ae,3,6,"ui-table",11),l(),s(16,"ui-modal",12),u("closed",function(){return a.closeModal()}),s(17,"div",13),f(18,oe,1,1,"ui-input",14)(19,se,1,3,"ui-select",15),l(),s(20,"div",16),f(21,le,4,2)(22,re,4,2),l()()()),e&2&&(c(8),p("loading",a.isLoading),c(4),C(a.errorMessage?12:-1),c(),p("hoverable",!1),c(),C(a.isLoading?14:15),c(2),p("isOpen",a.isModalOpen)("title",a.modalTitle())("showFooter",!0),c(2),C(a.modalMode==="create"||a.modalMode==="edit"?18:a.modalMode==="assign"?19:-1),c(3),C(a.modalMode==="create"||a.modalMode==="edit"?21:22))},dependencies:[P,H,O,N,R,z,j,q,F,B,$,W,U,G],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.page__top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:1rem;flex-wrap:wrap}.page__title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-primary)}.page__subtitle[_ngcontent-%COMP%]{color:var(--text-tertiary)}.page__actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.page__loading[_ngcontent-%COMP%]{padding:2rem 0;display:flex;justify-content:center}.row-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem}.grid-2[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem}"]})};export{K as DeanSpecialities};
