import{a as Y}from"./chunk-5HN4BRYP.js";import"./chunk-LSE4QE4L.js";import{c as j,j as G,n as K}from"./chunk-ZPZWYV2O.js";import"./chunk-DX4RU2C5.js";import{a as $,b as J}from"./chunk-C546SSYU.js";import"./chunk-KSJF27MU.js";import"./chunk-3OLBZRES.js";import{a as H,b as V}from"./chunk-YL2QS7YU.js";import"./chunk-HQOA22C6.js";import{d as B,h as R}from"./chunk-3WAO3F22.js";import{$a as d,Ab as u,Bb as A,Ka as D,Oa as h,Tb as y,Va as v,Wa as C,Xb as Q,Z as b,a as T,ab as i,b as I,ba as S,bb as t,ca as O,cb as M,gb as z,gc as F,hb as q,hc as L,jb as k,la as f,lb as w,nb as m,p as x,rc as U,wb as N,yb as r,za as s,zb as _}from"./chunk-T26DWB6S.js";function X(o,n){o&1&&(i(0,"div",14),M(1,"ui-spinner",15),i(2,"p"),r(3,"Loading quiz details..."),t()())}function Z(o,n){if(o&1&&(i(0,"ui-alert",16),r(1),t()),o&2){let e=m();s(),u(" ",e.errorMessage()," ")}}function ee(o,n){if(o&1&&(i(0,"ui-badge",25),r(1),t()),o&2){let e=m(2);s(),u(" ",e.questionBreakdown().singleChoice," Single Choice ")}}function te(o,n){if(o&1&&(i(0,"ui-badge",26),r(1),t()),o&2){let e=m(2);s(),u(" ",e.questionBreakdown().multipleChoice," Multi-Select ")}}function ne(o,n){if(o&1&&(i(0,"ui-badge",27),r(1),t()),o&2){let e=m(2);s(),u(" ",e.questionBreakdown().trueFalse," True/False ")}}function ie(o,n){if(o&1&&(i(0,"ui-badge",28),r(1),t()),o&2){let e=m(2);s(),u(" ",e.questionBreakdown().openEnded," Essay ")}}function re(o,n){o&1&&(i(0,"mat-icon",55),r(1,"check_circle"),t())}function oe(o,n){if(o&1&&(i(0,"div",51)(1,"span",52),r(2),t(),i(3,"span",53),r(4),t(),h(5,re,2,0,"mat-icon",54),t()),o&2){let e=n.$implicit,l=n.index,c=m(2).$implicit,p=m(2);N("correct",e===c.correctAnswer),s(2),_(p.getOptionLetter(l)),s(2),_(e),s(),d("ngIf",e===c.correctAnswer)}}function ae(o,n){if(o&1&&(i(0,"div",49),h(1,oe,6,5,"div",50),t()),o&2){let e=m().$implicit;s(),d("ngForOf",e.proposedAnswers)}}function se(o,n){if(o&1&&(i(0,"div",56)(1,"span",57),r(2,"Answer:"),t(),i(3,"ui-badge",23),r(4),t()()),o&2){let e=m().$implicit;s(3),d("color",e.correctAnswer==="true"?"success":"danger"),s(),u(" ",e.correctAnswer==="true"?"True":"False"," ")}}function ce(o,n){o&1&&(i(0,"div",58)(1,"mat-icon"),r(2,"edit_note"),t(),i(3,"span"),r(4,"Open-ended response (for sentiment analysis)"),t()())}function le(o,n){if(o&1&&(i(0,"div",40)(1,"div",41)(2,"div",42)(3,"span",43),r(4),t(),i(5,"ui-badge",23),r(6),t(),i(7,"span",44),r(8),t()(),i(9,"p",45),r(10),t(),h(11,ae,2,1,"div",46)(12,se,5,2,"div",47)(13,ce,5,0,"div",48),t()()),o&2){let e=n.$implicit,l=n.index,c=m(2);s(4),u("Q",l+1),s(),d("color",c.getQuestionTypeColor(e.type)),s(),u(" ",c.getQuestionTypeLabel(e.type)," "),s(2),A("",e.markAllocation," ",e.markAllocation===1?"mark":"marks"),s(2),_(e.question),s(),d("ngIf",e.type!=="OPEN_ENDED"&&e.proposedAnswers&&e.proposedAnswers.length>0),s(),d("ngIf",e.type==="TRUE_FALSE"),s(),d("ngIf",e.type==="OPEN_ENDED")}}function de(o,n){if(o&1){let e=k();z(0),i(1,"ui-card",17)(2,"div",18)(3,"div",19)(4,"h3"),r(5,"Course & Type"),t(),i(6,"div",20)(7,"span",21),r(8,"Course"),t(),i(9,"span",22),r(10),t()(),i(11,"div",20)(12,"span",21),r(13,"Quiz Type"),t(),i(14,"ui-badge",23),r(15),t()(),i(16,"div",20)(17,"span",21),r(18,"Lectures Covered"),t(),i(19,"span",22),r(20),t()()(),i(21,"div",19)(22,"h3"),r(23,"Schedule"),t(),i(24,"div",20)(25,"span",21),r(26,"Date & Time"),t(),i(27,"span",22),r(28),t()(),i(29,"div",20)(30,"span",21),r(31,"Duration"),t(),i(32,"span",22),r(33),t()()(),i(34,"div",19)(35,"h3"),r(36,"Questions"),t(),i(37,"div",20)(38,"span",21),r(39,"Total Questions"),t(),i(40,"span",22),r(41),t()(),i(42,"div",20)(43,"span",21),r(44,"Total Marks"),t(),i(45,"span",22),r(46),t()(),i(47,"div",20)(48,"span",21),r(49,"Question Types"),t(),i(50,"div",24),v(51,ee,2,1,"ui-badge",25),v(52,te,2,1,"ui-badge",26),v(53,ne,2,1,"ui-badge",27),v(54,ie,2,1,"ui-badge",28),t()()()()(),i(55,"ui-card",29)(56,"div",30),h(57,le,14,9,"div",31),t()(),i(58,"ui-card",32)(59,"div",33)(60,"div",34)(61,"mat-icon"),r(62,"info"),t()(),i(63,"div",35)(64,"h3"),r(65,"Ready to Publish"),t(),i(66,"p"),r(67,"When you publish this quiz:"),t(),i(68,"ul")(69,"li"),r(70,"All students enrolled in the selected course will be automatically invited"),t(),i(71,"li"),r(72,"The quiz will become available at the scheduled date and time"),t(),i(73,"li"),r(74,"You can still edit questions before the quiz starts"),t()()()()(),i(75,"div",36)(76,"ui-button",37),w("clicked",function(){S(e);let c=m();return O(c.goBack())}),i(77,"mat-icon",38),r(78,"arrow_back"),t(),r(79," Back "),t(),i(80,"ui-button",39),w("clicked",function(){S(e);let c=m();return O(c.publishQuiz())}),i(81,"mat-icon",38),r(82,"publish"),t(),r(83),t()(),q()}if(o&2){let e,l,c,p,g,a=m();s(10),_(a.courseName()),s(4),d("color",a.getTypeColor((e=a.step1Data())==null?null:e.type)),s(),u(" ",a.getTypeLabel((l=a.step1Data())==null?null:l.type)," "),s(5),_((c=a.step1Data())==null?null:c.lectures),s(8),_(a.formatDate((p=a.step1Data())==null?null:p.date)),s(5),u("",(g=a.step1Data())==null?null:g.durationMinutes," minutes"),s(8),_(a.questions().length),s(5),_(a.totalMarks()),s(5),C(a.questionBreakdown().singleChoice>0?51:-1),s(),C(a.questionBreakdown().multipleChoice>0?52:-1),s(),C(a.questionBreakdown().trueFalse>0?53:-1),s(),C(a.questionBreakdown().openEnded>0?54:-1),s(3),d("ngForOf",a.questions()),s(23),d("loading",a.isPublishing())("disabled",a.isPublishing()),s(3),u(" ",a.isPublishing()?"Publishing...":"Publish Quiz"," ")}}var W=class o{router=b(B);teacherApi=b(Y);cdr=b(Q);isLoading=f(!1);isPublishing=f(!1);errorMessage=f("");step1Data=f(null);step2Data=f(null);courses=f([]);questions=y(()=>this.step2Data()?.questions??[]);totalMarks=y(()=>this.questions().reduce((n,e)=>n+e.markAllocation,0));courseName=y(()=>{let n=this.step1Data()?.courseId;if(!n)return"Not selected";let e=this.courses().find(p=>p.id===n),l=e?.teachingUnit?.name??this.step1Data()?.teachingUnitName??"Unknown Course",c=e?.classAcademicYear?.class?.name??"";return c?`${l} \u2014 ${c}`:l});questionBreakdown=y(()=>{let n=this.questions();return{singleChoice:n.filter(e=>e.type==="SINGLE_CHOICE").length,multipleChoice:n.filter(e=>e.type==="MULTIPLE_CHOICE").length,trueFalse:n.filter(e=>e.type==="TRUE_FALSE").length,openEnded:n.filter(e=>e.type==="OPEN_ENDED").length}});async ngOnInit(){this.loadFormData(),await this.loadCourses()}loadFormData(){let n=sessionStorage.getItem("examFormStep1");if(n)try{this.step1Data.set(JSON.parse(n))}catch{this.errorMessage.set("Failed to load quiz details. Please go back and try again.")}let e=sessionStorage.getItem("examFormStep2");if(e)try{this.step2Data.set(JSON.parse(e))}catch{this.errorMessage.set("Failed to load questions. Please go back and try again.")}(!this.step1Data()||!this.step2Data())&&this.errorMessage.set("Missing quiz data. Please start from the beginning.")}async loadCourses(){try{let n=await x(this.teacherApi.getMyCourses());this.courses.set(n)}catch{}}getTypeLabel(n){return n?{CA:"Continuous Assessment",MEDIAN:"Midterm",FINAL:"Final Exam",MOCK:"Mock Test"}[n]||n:"Unknown"}getTypeColor(n){return n&&{CA:"info",MEDIAN:"warning",FINAL:"danger",MOCK:"secondary"}[n]||"neutral"}getQuestionTypeLabel(n){return{SINGLE_CHOICE:"Single Choice",MULTIPLE_CHOICE:"Multi-Select",TRUE_FALSE:"True/False",OPEN_ENDED:"Essay"}[n]||n}getQuestionTypeColor(n){return{SINGLE_CHOICE:"primary",MULTIPLE_CHOICE:"secondary",TRUE_FALSE:"info",OPEN_ENDED:"warning"}[n]||"neutral"}getOptionLetter(n){return String.fromCharCode(65+n)}formatDate(n){if(!n)return"Not set";try{return new Date(n).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return n}}goBack(){this.router.navigate(["/teacher/create-exam/step2"])}async publishQuiz(){let n=this.step1Data(),e=this.step2Data();if(!n||!e||e.questions.length===0){alert("Missing quiz data. Please go back and complete all steps.");return}this.isPublishing.set(!0);try{let l=this.courses().find(a=>a.id===n.courseId),c=l?.teachingUnit?.id??n.teachingUnitId??"";if(!c)try{let a=await x(this.teacherApi.getMyCourses());this.courses.set(a),l=a.find(E=>E.id===n.courseId)??l,c=l?.teachingUnit?.id??n.teachingUnitId??""}catch(a){console.warn("Failed to refresh courses while publishing quiz:",a)}if(!c){alert("Course must have a teaching unit for question categorization."),this.isPublishing.set(!1);return}let p={courseId:String(n.courseId),type:String(n.type),lectures:Number(n.lectures),date:String(n.date),durationMinutes:Number(n.durationMinutes),newQuestions:e.questions.map(a=>{let E=a.type==="OPEN_ENDED";return I(T({question:String(a.question).trim(),type:String(a.type),difficultyLevel:"LEVEL_3",teachingUnitId:c},E?{}:{proposedAnswers:a.proposedAnswers.map(P=>String(P).trim()).filter(P=>P.length>0),correctAnswer:String(a.correctAnswer).trim()}),{markAllocation:Number(a.markAllocation)})})};console.log("Publishing quiz with payload:",JSON.stringify(p,null,2));let g=await x(this.teacherApi.createQuiz(p));try{await x(this.teacherApi.publishQuiz(g.id))}catch(a){throw console.error("Quiz created but failed to publish:",a),a}sessionStorage.removeItem("examFormStep1"),sessionStorage.removeItem("examFormStep2"),alert("Quiz published successfully! Students have been invited."),this.router.navigate(["/teacher/exam-manager"])}catch(l){let c=l;console.error("Failed to publish quiz:",c);let p=c?.status??null,g=c?.error??c?.message??c;p&&console.error("HTTP status:",p),g&&console.error("Server response body:",g);let a=g&&(g.message||g.error||JSON.stringify(g))||(c instanceof Error?c.message:"Failed to publish quiz. Please try again.");alert(a)}finally{this.isPublishing.set(!1)}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-teacher-create-exam-step3"]],decls:39,vars:3,consts:[[1,"review-publish"],[1,"page-header"],["variant","elevated",1,"stepper-card"],[1,"progress-stepper"],[1,"step","completed"],[1,"step-number"],[1,"step-info"],[1,"step-title"],[1,"step-desc"],[1,"step-connector","completed"],[1,"step","active"],["class","loading-state",4,"ngIf"],["variant","filled","color","danger",4,"ngIf"],[4,"ngIf"],[1,"loading-state"],["size","lg"],["variant","filled","color","danger"],["variant","elevated","title","Quiz Summary"],[1,"summary-grid"],[1,"summary-section"],[1,"summary-item"],[1,"label"],[1,"value"],["size","sm",3,"color"],[1,"type-breakdown"],["color","primary","size","sm"],["color","secondary","size","sm"],["color","info","size","sm"],["color","warning","size","sm"],["variant","elevated","title","Questions Preview"],[1,"questions-preview"],["class","question-preview-item",4,"ngFor","ngForOf"],["variant","elevated"],[1,"publish-notice"],[1,"notice-icon"],[1,"notice-content"],[1,"form-actions"],["variant","outline","color","neutral",3,"clicked"],["slot","icon-left"],["variant","solid","color","primary",3,"clicked","loading","disabled"],[1,"question-preview-item"],[1,"question-preview-item-inner"],[1,"question-preview-header"],[1,"question-number"],[1,"question-marks"],[1,"question-text"],["class","answer-preview",4,"ngIf"],["class","tf-answer",4,"ngIf"],["class","open-ended-note",4,"ngIf"],[1,"answer-preview"],["class","answer-option",3,"correct",4,"ngFor","ngForOf"],[1,"answer-option"],[1,"option-letter"],[1,"option-text"],["class","correct-icon",4,"ngIf"],[1,"correct-icon"],[1,"tf-answer"],[1,"answer-label"],[1,"open-ended-note"]],template:function(e,l){e&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),r(3,"Review & Publish"),t(),i(4,"p"),r(5,"Review your quiz details before publishing. Students will be automatically invited."),t()(),i(6,"ui-card",2)(7,"div",3)(8,"div",4)(9,"div",5)(10,"mat-icon"),r(11,"check"),t()(),i(12,"div",6)(13,"span",7),r(14,"Quiz Details"),t(),i(15,"span",8),r(16,"Course, type & schedule"),t()()(),M(17,"div",9),i(18,"div",4)(19,"div",5)(20,"mat-icon"),r(21,"check"),t()(),i(22,"div",6)(23,"span",7),r(24,"Add Questions"),t(),i(25,"span",8),r(26,"Build your quiz"),t()()(),M(27,"div",9),i(28,"div",10)(29,"div",5),r(30,"3"),t(),i(31,"div",6)(32,"span",7),r(33,"Review & Publish"),t(),i(34,"span",8),r(35,"Final review"),t()()()()(),h(36,X,4,0,"div",11)(37,Z,2,1,"ui-alert",12)(38,de,84,16,"ng-container",13),t()),e&2&&(s(36),d("ngIf",l.isLoading()),s(),d("ngIf",l.errorMessage()),s(),d("ngIf",!l.isLoading()&&!l.errorMessage()))},dependencies:[U,F,L,V,H,R,J,$,j,K,G],styles:[".review-publish[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;margin-bottom:.5rem;color:var(--color-text-primary)}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:.938rem}.stepper-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.progress-stepper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:1rem 0}@media (max-width: 640px){.progress-stepper[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:50%;background:var(--color-background-muted);color:var(--color-text-secondary);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.938rem}.step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--color-primary-600);color:#fff}.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--color-success-600);color:#fff}.step[_ngcontent-%COMP%]   .step-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.step[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text-primary)}.step.active[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{color:var(--color-primary-600);font-weight:600}.step[_ngcontent-%COMP%]   .step-desc[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-text-tertiary)}.step-connector[_ngcontent-%COMP%]{flex:1;height:2px;background:var(--color-border-default);margin:0 1.5rem;max-width:80px}.step-connector.completed[_ngcontent-%COMP%]{background:var(--color-success-600)}@media (max-width: 640px){.step-connector[_ngcontent-%COMP%]{display:none}}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;color:var(--color-text-secondary)}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:1rem}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:2rem}.summary-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--color-text-secondary);text-transform:uppercase;letter-spacing:.05em;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid var(--color-border-subtle)}.summary-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;margin-bottom:.875rem}.summary-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.813rem;color:var(--color-text-tertiary)}.summary-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1rem;color:var(--color-text-primary);font-weight:500}.type-breakdown[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.25rem}.questions-preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.question-preview-item[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--color-border-default);border-radius:8px;background:var(--surface-base)}.question-preview-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem}.question-preview-header[_ngcontent-%COMP%]   .question-number[_ngcontent-%COMP%]{font-weight:600;color:var(--color-primary-600)}.question-preview-header[_ngcontent-%COMP%]   .question-marks[_ngcontent-%COMP%]{margin-left:auto;font-size:.813rem;color:var(--color-text-secondary)}.question-text[_ngcontent-%COMP%]{font-size:.938rem;color:var(--color-text-primary);line-height:1.5;margin-bottom:.75rem}.answer-preview[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.375rem}.answer-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border:1px solid var(--color-border-subtle);border-radius:6px;font-size:.875rem}.answer-option.correct[_ngcontent-%COMP%]{background:var(--color-success-50);border-color:var(--color-success-300)}.answer-option[_ngcontent-%COMP%]   .option-letter[_ngcontent-%COMP%]{font-weight:600;color:var(--color-text-secondary);min-width:1.25rem}.answer-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]{flex:1;color:var(--color-text-primary)}.answer-option[_ngcontent-%COMP%]   .correct-icon[_ngcontent-%COMP%]{color:var(--color-success-600);font-size:1rem;width:1rem;height:1rem}.tf-answer[_ngcontent-%COMP%], .open-ended-note[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem}.tf-answer[_ngcontent-%COMP%]   .answer-label[_ngcontent-%COMP%], .open-ended-note[_ngcontent-%COMP%]   .answer-label[_ngcontent-%COMP%]{color:var(--color-text-secondary)}.open-ended-note[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-style:italic}.open-ended-note[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.125rem;width:1.125rem;height:1.125rem}.publish-notice[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:.5rem}.publish-notice[_ngcontent-%COMP%]   .notice-icon[_ngcontent-%COMP%]{flex-shrink:0}.publish-notice[_ngcontent-%COMP%]   .notice-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.5rem;width:1.5rem;height:1.5rem;color:var(--color-info-500)}.publish-notice[_ngcontent-%COMP%]   .notice-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--color-text-primary);margin-bottom:.5rem}.publish-notice[_ngcontent-%COMP%]   .notice-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary);margin-bottom:.5rem}.publish-notice[_ngcontent-%COMP%]   .notice-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding-left:1.25rem}.publish-notice[_ngcontent-%COMP%]   .notice-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary);margin-bottom:.375rem;line-height:1.4}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid var(--color-border-subtle)}[_nghost-%COMP%]     ui-card{margin-bottom:1.5rem}[_nghost-%COMP%]     .card__body{padding:1.5rem}"]})};export{W as TeacherCreateExamStep3};
