import{a as G}from"./chunk-FHBBJYU2.js";import"./chunk-FWCO3CJY.js";import{c as $,f as L,j as W}from"./chunk-AO6LNOWB.js";import{a as B}from"./chunk-SJBCNNOS.js";import{a as V,b as U}from"./chunk-2WUHN5CQ.js";import"./chunk-MAWX5T35.js";import{c as F,f as R,n as z,u as j}from"./chunk-XGVRFAFZ.js";import"./chunk-4BWE2P25.js";import"./chunk-LUIYB3PI.js";import"./chunk-LM6INHLT.js";import{$a as m,Ab as x,Db as Y,Eb as T,Fb as N,Ka as E,Oa as A,Pb as C,Va as b,Wa as h,Ya as I,Z as S,Za as y,_a as v,ab as i,ba as w,bb as r,ca as M,cb as D,jb as P,lb as k,nb as _,p as f,rc as H,xb as O,yb as l,za as c,zb as g}from"./chunk-3XB4H34J.js";var q=(n,t)=>t.name,K=(n,t)=>t.message;function Q(n,t){if(n&1&&(i(0,"ui-alert",8),l(1),r()),n&2){let e=_();c(),x(" ",e.errorMessage," ")}}function X(n,t){n&1&&(i(0,"div",29)(1,"ui-button",30),l(2,"View"),r()())}function Z(n,t){if(n&1&&l(0),n&2){let e=_(),a=e.$implicit,o=e.column;x(" ",a[o.key]," ")}}function ee(n,t){if(n&1&&b(0,X,3,0,"div",29)(1,Z,1,1),n&2){let e,a=t.column;h((e=a.key)==="actions"?0:1)}}function te(n,t){if(n&1&&(i(0,"div",22),l(1),r()),n&2){let e=t.$implicit;c(),g(e)}}function ae(n,t){if(n&1&&(i(0,"div",31)(1,"div",32),l(2),r(),i(3,"div",33),l(4),r()()),n&2){let e=t.$implicit;O("exam-item exam-item--"+e.tone),c(2),g(e.name),c(2),g(e.time)}}function ne(n,t){if(n&1&&(i(0,"div",27),D(1,"span"),i(2,"div",34)(3,"div",35),l(4),r(),i(5,"div",36),l(6),r()()()),n&2){let e=t.$implicit,a=_();c(),O(a.activityDotClass(e.tone)),c(3),g(e.message),c(2),g(e.timeAgo)}}function ie(n,t){n&1&&(i(0,"div",37),l(1,"No critical alerts right now."),r())}function re(n,t){if(n&1&&(i(0,"ui-badge",38),l(1),r()),n&2){let e=_().$implicit,a=_();m("color",a.moodColor(e.mood)),c(),g(e.mood)}}function oe(n,t){n&1&&(i(0,"div",29)(1,"ui-button",30),l(2,"Review"),r()())}function se(n,t){if(n&1&&l(0),n&2){let e=_(),a=e.$implicit,o=e.column;x(" ",a[o.key]," ")}}function de(n,t){if(n&1&&b(0,re,2,2,"ui-badge",38)(1,oe,3,0,"div",29)(2,se,1,1),n&2){let e,a=t.column;h((e=a.key)==="mood"?0:e==="actions"?1:2)}}var J=class n{headApi=S(G);loading=!1;errorMessage="";classesColumns=[{key:"id",label:"ID",sortable:!0,width:"90px"},{key:"className",label:"Class",sortable:!0},{key:"level",label:"Level",sortable:!0,width:"90px",align:"center"},{key:"students",label:"Students",sortable:!0,width:"110px",align:"center"},{key:"teachers",label:"Teachers",sortable:!0,width:"110px",align:"center"},{key:"actions",label:"Actions",sortable:!1,width:"120px",align:"right"}];classesData=[];weekdays=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];weekLabel="Week of Nov 10 - Nov 16";upcomingExams=[];activity=[];sentimentColumns=[{key:"student",label:"Student",sortable:!0},{key:"department",label:"Department",sortable:!0},{key:"exam",label:"Exam",sortable:!0},{key:"mood",label:"Mood",sortable:!0,width:"110px",align:"center"},{key:"flagged",label:"Flagged",sortable:!0,width:"120px",align:"center"},{key:"actions",label:"Action",sortable:!1,width:"120px",align:"right"}];sentimentData=[];moodColor(t){return t==="High"?"danger":t==="Medium"?"warning":"info"}activityDotClass(t){return`dot dot--${t}`}academicYears=[];classAcademicYears=[];courses=[];selectedAcademicYearId="";academicYearOptions(){let t=[{value:"",label:"All academic years"}];for(let e of this.academicYears)t.push({value:e.id,label:`${e.start.split("-")[0]}\u2013${e.end.split("-")[0]}`});return t}onFilterChanged(){this.loadForAcademicYear(this.selectedAcademicYearId)}async loadAll(){this.loading=!0,this.errorMessage="";try{this.academicYears=await f(this.headApi.listAcademicYears()),this.selectedAcademicYearId||(this.selectedAcademicYearId=this.pickLatestAcademicYearId(this.academicYears)),await this.loadForAcademicYear(this.selectedAcademicYearId)}catch(t){this.errorMessage=t instanceof Error?t.message:"Failed to load dashboard data."}finally{this.loading=!1}}async loadForAcademicYear(t){this.loading=!0,this.errorMessage="";try{let e=t?.trim()||void 0,[a,o]=await Promise.all([f(this.headApi.listClasses(e)),f(this.headApi.listCourses(e))]);this.classAcademicYears=a,this.courses=o,this.recomputeDashboard()}catch(e){this.errorMessage=e instanceof Error?e.message:"Failed to load dashboard data."}finally{this.loading=!1}}pickLatestAcademicYearId(t){let e=o=>{if(typeof o!="string")return Number.NEGATIVE_INFINITY;let d=Date.parse(o);return Number.isFinite(d)?d:Number.NEGATIVE_INFINITY};return t.filter(o=>!!o?.id).map(o=>{let d=e(o.end),s=e(o.start);return{ay:o,score:d!==Number.NEGATIVE_INFINITY?d:s}}).sort((o,d)=>d.score-o.score)[0]?.ay?.id??""}getUser(){return JSON.parse(localStorage.getItem("currentUser")||"{}")}recomputeDashboard(){let t=this.selectedAcademicYearId?.trim()||void 0,e=this.getUser()?.speciality?.name,a=this.classAcademicYears.filter(s=>{if(t&&s.academicYear?.id!==t)return!1;let p=s.class?.speciality?.name;return!(e&&p&&p!==e)}),o=this.courses.filter(s=>{if(t&&s.classAcademicYear?.academicYear?.id!==t)return!1;let p=s.classAcademicYear?.class?.speciality?.name;return!(e&&p&&p!==e)});this.classesData=this.buildClassesOverview(a,o);let d=new Set;for(let s of o){let u=s.teacher?.id;u&&d.add(u)}this.stats={classesManaged:a.length,students:0,teachers:d.size,upcomingExams:this.upcomingExams.length}}buildClassesOverview(t,e){let a=new Map;for(let d of t){if(!d?.id)continue;let s=d.class;s?.name&&a.set(d.id,{id:s.id??d.id,className:s.name,level:Number(s.level)||0,students:0,teachers:0})}let o=new Map;for(let d of e){let s=d.classAcademicYear?.id,u=d.teacher?.id;if(!s||!u)continue;let p=o.get(s)??new Set;p.add(u),o.set(s,p)}for(let[d,s]of a.entries())s.teachers=o.get(d)?.size??0;return Array.from(a.values()).sort((d,s)=>d.className.localeCompare(s.className))}stats={classesManaged:0,students:0,teachers:0,upcomingExams:0};ngOnInit(){this.loadAll()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["app-head-dashboard"]],decls:55,vars:15,consts:[["cell",""],["empty",""],[1,"dashboard"],[1,"dashboard__header"],[1,"dashboard__title-section"],[1,"dashboard__title"],[1,"dashboard__subtitle"],["label","Scope",3,"ngModelChange","options","ngModel","searchable"],["type","danger","variant","outlined"],[1,"dashboard__stats"],["label","Classes Managed","color","primary","icon","class","format","number",3,"value"],["label","Students","color","accent","icon","star","format","number",3,"value"],["label","Teachers","color","info","icon","groups","format","number",3,"value"],["label","Upcoming Exams","color","warning","icon","warning","format","number",3,"value"],[1,"dashboard__grid"],["variant","outlined",1,"panel"],[1,"panel__header"],[1,"panel__title"],[1,"panel__subtitle"],[3,"columns","data","searchable"],[1,"calendar-header"],[1,"calendar-weekdays"],[1,"weekday"],[1,"exams-list"],[1,"exam-item",3,"class"],[1,"dashboard__grid","dashboard__grid--bottom"],[1,"activity-list"],[1,"activity-item"],["emptyMessage","",3,"columns","data","searchable"],[1,"table-actions"],["size","sm","variant","soft","color","primary"],[1,"exam-item"],[1,"exam-name"],[1,"exam-time"],[1,"activity-item__content"],[1,"activity-item__message"],[1,"activity-item__time"],[1,"table-empty"],["variant","subtle",3,"color"]],template:function(e,a){if(e&1){let o=P();i(0,"div",2)(1,"header",3)(2,"div",4)(3,"h1",5),l(4,"Dashboard Overview"),r(),i(5,"p",6),l(6,"Monitor classes, students and teachers"),r()(),i(7,"ui-select",7),N("ngModelChange",function(s){return w(o),T(a.selectedAcademicYearId,s)||(a.selectedAcademicYearId=s),M(s)}),k("ngModelChange",function(){return w(o),M(a.onFilterChanged())}),r()(),b(8,Q,2,1,"ui-alert",8),i(9,"section",9),D(10,"ui-stat-card",10)(11,"ui-stat-card",11)(12,"ui-stat-card",12)(13,"ui-stat-card",13),r(),i(14,"section",14)(15,"ui-card",15)(16,"div",16)(17,"div",17),l(18,"Classes Overview"),r(),i(19,"div",18),l(20,"Teacher/class assignments are completed by specialty heads."),r()(),i(21,"ui-table",19),A(22,ee,2,1,"ng-template",null,0,C),r()(),i(24,"ui-card",15)(25,"div",16)(26,"div",17),l(27,"Upcoming Exams"),r()(),i(28,"div",20),l(29),r(),i(30,"div",21),y(31,te,2,1,"div",22,I),r(),i(33,"div",23),y(34,ae,5,4,"div",24,q),r()()(),i(36,"section",25)(37,"ui-card",15)(38,"div",16)(39,"div",17),l(40,"Recent Activity"),r()(),i(41,"div",26),y(42,ne,7,4,"div",27,K),r()(),i(44,"ui-card",15)(45,"div",16)(46,"div",17),l(47,"Critical Sentiment Alerts"),r(),i(48,"div",18),l(49,"Essays flagged for immediate counselor review"),r()(),i(50,"ui-table",28),A(51,ie,2,0,"ng-template",null,1,C)(53,de,3,1,"ng-template",null,0,C),r()()()()}e&2&&(c(7),m("options",a.academicYearOptions()),Y("ngModel",a.selectedAcademicYearId),m("searchable",!0),c(),h(a.errorMessage?8:-1),c(2),m("value",a.stats.classesManaged),c(),m("value",a.stats.students),c(),m("value",a.stats.teachers),c(),m("value",a.stats.upcomingExams),c(8),m("columns",a.classesColumns)("data",a.classesData)("searchable",!1),c(8),g(a.weekLabel),c(2),v(a.weekdays),c(3),v(a.upcomingExams),c(8),v(a.activity),c(8),m("columns",a.sentimentColumns)("data",a.sentimentData)("searchable",!1))},dependencies:[H,z,F,R,U,B,j,V,$,L,W],styles:[".dashboard[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem;padding:.5rem}.dashboard__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;flex-wrap:wrap}.dashboard__title-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.dashboard__title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:var(--text-primary);margin:0}.dashboard__subtitle[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-tertiary);margin:0}.dashboard__stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem}@media (max-width: 1100px){.dashboard__stats[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 600px){.dashboard__stats[_ngcontent-%COMP%]{grid-template-columns:1fr}}.dashboard__grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;align-items:start}@media (max-width: 1100px){.dashboard__grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.dashboard__grid--bottom[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}@media (max-width: 1100px){.dashboard__grid--bottom[_ngcontent-%COMP%]{grid-template-columns:1fr}}.panel[_ngcontent-%COMP%]{width:100%}.panel__header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;padding:.25rem 0 1rem}.panel__title[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:var(--text-primary)}.panel__subtitle[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--text-tertiary)}.table-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.table-empty[_ngcontent-%COMP%]{padding:1rem 0;color:var(--text-tertiary);font-size:.875rem}.calendar-header[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-tertiary);margin-bottom:.75rem}.calendar-weekdays[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:.5rem;margin-bottom:.75rem}.weekday[_ngcontent-%COMP%]{text-align:center;font-size:.75rem;color:var(--text-tertiary)}.exams-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.exam-item[_ngcontent-%COMP%]{padding:.75rem;border-radius:10px;border:1px solid var(--border-subtle)}.exam-item--info[_ngcontent-%COMP%]{background:var(--surface-info);border-color:var(--color-info-border)}.exam-item--success[_ngcontent-%COMP%]{background:var(--surface-success);border-color:var(--color-success-border)}.exam-item--warning[_ngcontent-%COMP%]{background:var(--surface-warning);border-color:var(--color-warning-border)}.exam-item--danger[_ngcontent-%COMP%]{background:var(--surface-danger);border-color:var(--color-danger-border)}.exam-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:700;color:var(--text-primary)}.exam-time[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-tertiary);margin-top:.25rem}.activity-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.activity-item[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:flex-start}.activity-item__content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.activity-item__message[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-primary)}.activity-item__time[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-tertiary)}.dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:999px;margin-top:.35rem;flex:0 0 10px}.dot--info[_ngcontent-%COMP%]{background:var(--color-info)}.dot--success[_ngcontent-%COMP%]{background:var(--color-success)}.dot--warning[_ngcontent-%COMP%]{background:var(--color-warning)}.dot--danger[_ngcontent-%COMP%]{background:var(--color-danger)}.dot--primary[_ngcontent-%COMP%]{background:var(--color-primary)}.dot--neutral[_ngcontent-%COMP%]{background:var(--text-tertiary)}.dot--secondary[_ngcontent-%COMP%]{background:var(--color-secondary)}.dot--accent[_ngcontent-%COMP%]{background:var(--color-accent)}"]})};export{J as HeadDashboard};
