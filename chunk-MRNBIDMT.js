import{a as H}from"./chunk-JP3RDASN.js";import"./chunk-O6YQIL4L.js";import{f as F,j as R,n as U}from"./chunk-AO6LNOWB.js";import"./chunk-SJBCNNOS.js";import{a as V,b as z}from"./chunk-2WUHN5CQ.js";import{a as N}from"./chunk-MAWX5T35.js";import{c as k,f as T,n as O,t as W,u as B}from"./chunk-XGVRFAFZ.js";import{a as P,b as L}from"./chunk-4BWE2P25.js";import"./chunk-LUIYB3PI.js";import"./chunk-LM6INHLT.js";import{$a as c,Ab as u,Db as _,Eb as g,Fb as h,Ka as v,Oa as x,Pb as I,Va as D,Wa as y,Xb as Y,Z as M,ab as s,ba as C,bb as r,ca as S,cb as A,jb as w,lb as p,nb as l,p as f,rc as E,yb as d,za as m}from"./chunk-3XB4H34J.js";function G(n,t){if(n&1&&(s(0,"ui-alert",9),d(1),r()),n&2){let e=l();m(),u(" ",e.errorMessage," ")}}function J(n,t){n&1&&(s(0,"div",11),A(1,"ui-spinner",25),r())}function K(n,t){if(n&1&&d(0),n&2){let e=l().$implicit;u(" ",e.name," ")}}function Q(n,t){if(n&1&&d(0),n&2){let e=l().$implicit;u(" ",e.shortCode," ")}}function X(n,t){if(n&1&&d(0),n&2){let e=l().$implicit;u(" ",e.status," ")}}function Z(n,t){if(n&1&&d(0),n&2){let e=l().$implicit;u(" ",e.classAcademicYear==null||e.classAcademicYear.class==null?null:e.classAcademicYear.class.name," ")}}function ee(n,t){if(n&1&&d(0),n&2){let e=l().$implicit,i=l(2);u(" ",i.formatAcademicYear(e)," ")}}function te(n,t){if(n&1&&d(0),n&2){let e=l().$implicit,i=l(2);u(" ",i.formatDates(e)," ")}}function ie(n,t){if(n&1&&d(0),n&2){let e=l().$implicit;u(" ",e.updatedAt," ")}}function ae(n,t){if(n&1){let e=w();s(0,"div",27)(1,"ui-button",28),p("clicked",function(){C(e);let o=l().$implicit,a=l(2);return S(a.openEdit(o))}),s(2,"mat-icon",29),d(3,"edit"),r(),d(4," Edit "),r(),s(5,"ui-button",30),p("clicked",function(){C(e);let o=l().$implicit,a=l(2);return S(a.delete(o))}),s(6,"mat-icon",29),d(7,"delete"),r(),d(8," Delete "),r()()}n&2&&(m(),c("iconLeft",!0),m(4),c("iconLeft",!0))}function ne(n,t){if(n&1&&D(0,K,1,1)(1,Q,1,1)(2,X,1,1)(3,Z,1,1)(4,ee,1,1)(5,te,1,1)(6,ie,1,1)(7,ae,9,2,"div",27),n&2){let e,i=t.column;y((e=i.key)==="name"?0:e==="shortCode"?1:e==="status"?2:e==="class"?3:e==="academicYear"?4:e==="dates"?5:e==="updatedAt"?6:e==="actions"?7:-1)}}function oe(n,t){if(n&1){let e=w();s(0,"ui-table",26),p("sortChange",function(o){C(e);let a=l();return S(a.onSortChange(o))})("pageChange",function(o){C(e);let a=l();return S(a.onPageChange(o))})("pageSizeChange",function(o){C(e);let a=l();return S(a.onPageSizeChange(o))}),x(1,ne,8,1,"ng-template",null,0,I),r()}if(n&2){let e=l();c("columns",e.columns)("data",e.semesters)("showPagination",!0)("pagination",e.pagination)("sortColumn",e.sortColumn)("sortDirection",e.sortDirection)}}var $=class n{deanApi=M(H);cdr=M(Y);isLoading=!1;errorMessage="";academicYears=[];allSemesters=[];semesters=[];selectedAcademicYearId=null;pagination={page:1,pageSize:10,total:0,pageSizes:[5,10,25,50]};sortColumn=null;sortDirection=null;columns=[{key:"name",label:"Name",sortable:!0},{key:"shortCode",label:"Code",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"class",label:"Class"},{key:"academicYear",label:"Academic Year"},{key:"dates",label:"Dates"},{key:"updatedAt",label:"Updated",sortable:!0},{key:"actions",label:"Actions",width:"240px"}];isModalOpen=!1;modalMode="create";editingId=null;form={name:"",shortCode:"",classAcademicYearId:"",startDate:"",endDate:"",status:"SCHEDULED"};saveLoading=!1;statusOptions=[{value:"SCHEDULED",label:"Scheduled"},{value:"ACTIVE",label:"Active"},{value:"ACTION_NEEDED",label:"Action needed"},{value:"ARCHIVED",label:"Archived"}];toDateInputValue(t){return t?t.length>=10?t.slice(0,10):t:""}toIsoDateString(t){if(!t)return;if(t instanceof Date)return t.toISOString().slice(0,10);let e=t.trim();if(e)return e.length>=10?e.slice(0,10):e}async ngOnInit(){await this.loadAcademicYears(),await this.loadSemesters()}academicYearOptions(){let t=[{value:"",label:"All academic years"}];for(let e of this.academicYears)t.push({value:e.id,label:`${e.start}\u2013${e.end}`});return t}classAcademicYearOptions(){let t=[];for(let e of this.academicYears)if(!(this.selectedAcademicYearId&&e.id!==this.selectedAcademicYearId))for(let i of e.classAcademicYears??[])t.push(i);return t.filter(e=>!!e.class?.name).map(e=>({value:e.id,label:`${e.class?.name??"Class"} (${e.academicYear?.start??""}\u2013${e.academicYear?.end??""})`.trim()}))}async loadAcademicYears(){this.errorMessage="";try{this.academicYears=await f(this.deanApi.listAcademicYears())}catch(t){this.errorMessage=t instanceof Error?t.message:"Failed to load academic years."}}async loadSemesters(){this.errorMessage="",this.isLoading=!0;try{let t=this.selectedAcademicYearId||void 0;this.allSemesters=await f(this.deanApi.listSemesters(t)),this.pagination.total=this.allSemesters.length,this.pagination.page=1,this.updateDisplayedRows()}catch(t){this.errorMessage=t instanceof Error?t.message:"Failed to load semesters."}finally{this.isLoading=!1,this.cdr.markForCheck()}}updateDisplayedRows(){let t=[...this.allSemesters];this.sortColumn&&this.sortDirection&&(t=t.sort((o,a)=>{let j=o[this.sortColumn]??"",q=a[this.sortColumn]??"",b=String(j).localeCompare(String(q));return this.sortDirection==="asc"?b:-b}));let e=(this.pagination.page-1)*this.pagination.pageSize,i=e+this.pagination.pageSize;this.semesters=t.slice(e,i)}onSortChange(t){this.sortColumn=t.column||null,this.sortDirection=t.direction,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageChange(t){this.pagination.page=t,this.updateDisplayedRows(),this.cdr.markForCheck()}onPageSizeChange(t){this.pagination.pageSize=t,this.pagination.page=1,this.updateDisplayedRows(),this.cdr.markForCheck()}async onFilterChanged(){await this.loadSemesters()}openCreate(){this.modalMode="create",this.editingId=null;let t=this.classAcademicYearOptions();this.form={name:"",shortCode:"",classAcademicYearId:t[0]?.value??"",startDate:"",endDate:"",status:"SCHEDULED"},this.isModalOpen=!0}openEdit(t){this.modalMode="edit",this.editingId=t.id,this.form={name:t.name??"",shortCode:t.shortCode??"",classAcademicYearId:t.classAcademicYear?.id??"",startDate:this.toDateInputValue(t.startDate),endDate:this.toDateInputValue(t.endDate),status:t.status??"SCHEDULED"},this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.saveLoading=!1}validateForm(){return this.form.name.trim()?this.form.shortCode.trim()?this.form.classAcademicYearId?!0:(this.errorMessage="Class academic year is required.",!1):(this.errorMessage="Short code is required.",!1):(this.errorMessage="Name is required.",!1)}async save(){if(this.errorMessage="",!!this.validateForm()){this.saveLoading=!0;try{if(this.modalMode==="create"){let t={name:this.form.name.trim(),shortCode:this.form.shortCode.trim(),classAcademicYearId:this.form.classAcademicYearId,status:this.form.status,startDate:this.toIsoDateString(this.form.startDate),endDate:this.toIsoDateString(this.form.endDate)};await f(this.deanApi.createSemester(t))}else if(this.editingId){let t={name:this.form.name.trim(),shortCode:this.form.shortCode.trim(),status:this.form.status,startDate:this.toIsoDateString(this.form.startDate),endDate:this.toIsoDateString(this.form.endDate)};await f(this.deanApi.updateSemester(this.editingId,t))}this.closeModal(),await this.loadSemesters()}catch(t){this.errorMessage=t instanceof Error?t.message:"Save failed."}finally{this.saveLoading=!1,this.cdr.markForCheck()}}}async delete(t){if(this.errorMessage="",!!confirm(`Delete semester ${t.name}?`))try{await f(this.deanApi.deleteSemester(t.id)),await this.loadSemesters()}catch(i){this.errorMessage=i instanceof Error?i.message:"Delete failed."}}formatAcademicYear(t){let e=t.classAcademicYear?.academicYear;return e?`${e.start}\u2013${e.end}`:""}formatDates(t){let e=this.toDateInputValue(t.startDate),i=this.toDateInputValue(t.endDate);return!e&&!i?"":e&&i?`${e} \u2192 ${i}`:e||i}modalTitle(){return this.modalMode==="create"?"Create Semester":"Edit Semester"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=v({type:n,selectors:[["app-dean-semesters"]],decls:31,vars:23,consts:[["cell",""],[1,"page"],[1,"page__top"],[1,"page__title"],[1,"page__subtitle"],[1,"page__actions"],["label","Scope",3,"ngModelChange","options","ngModel","searchable"],["variant","outline","color","neutral",3,"clicked","loading"],["variant","solid","color","primary",3,"clicked"],["type","danger","variant","outlined"],["title","Semesters",3,"hoverable"],[1,"page__loading"],[3,"columns","data","showPagination","pagination","sortColumn","sortDirection"],[3,"closed","isOpen","title","showFooter"],[1,"form"],["label","Name","placeholder","e.g. Semester 1",3,"ngModelChange","ngModel"],["label","Short Code","placeholder","e.g. S1",3,"ngModelChange","ngModel"],["label","Class Academic Year",3,"ngModelChange","options","ngModel","disabled","searchable"],["label","Status",3,"ngModelChange","options","ngModel","searchable"],[1,"grid-2"],["label","Start Date","type","date",3,"ngModelChange","ngModel"],["label","End Date","type","date",3,"ngModelChange","ngModel"],["slot","footer",1,"modal-actions"],["variant","ghost","color","neutral",3,"clicked","disabled"],["variant","solid","color","primary",3,"clicked","loading"],["size","lg"],[3,"sortChange","pageChange","pageSizeChange","columns","data","showPagination","pagination","sortColumn","sortDirection"],[1,"row-actions"],["size","sm","variant","soft","color","neutral",3,"clicked","iconLeft"],["slot","icon-left"],["size","sm","variant","soft","color","danger",3,"clicked","iconLeft"]],template:function(e,i){e&1&&(s(0,"div",1)(1,"div",2)(2,"div")(3,"div",3),d(4,"Semesters"),r(),s(5,"div",4),d(6,"Manage semesters per academic year/class."),r()(),s(7,"div",5)(8,"ui-select",6),h("ngModelChange",function(a){return g(i.selectedAcademicYearId,a)||(i.selectedAcademicYearId=a),a}),p("ngModelChange",function(){return i.onFilterChanged()}),r(),s(9,"ui-button",7),p("clicked",function(){return i.loadSemesters()}),d(10," Refresh "),r(),s(11,"ui-button",8),p("clicked",function(){return i.openCreate()}),d(12," New Semester "),r()()(),D(13,G,2,1,"ui-alert",9),s(14,"ui-card",10),D(15,J,2,0,"div",11)(16,oe,3,6,"ui-table",12),r(),s(17,"ui-modal",13),p("closed",function(){return i.closeModal()}),s(18,"div",14)(19,"ui-input",15),h("ngModelChange",function(a){return g(i.form.name,a)||(i.form.name=a),a}),r(),s(20,"ui-input",16),h("ngModelChange",function(a){return g(i.form.shortCode,a)||(i.form.shortCode=a),a}),r(),s(21,"ui-select",17),h("ngModelChange",function(a){return g(i.form.classAcademicYearId,a)||(i.form.classAcademicYearId=a),a}),r(),s(22,"ui-select",18),h("ngModelChange",function(a){return g(i.form.status,a)||(i.form.status=a),a}),r(),s(23,"div",19)(24,"ui-input",20),h("ngModelChange",function(a){return g(i.form.startDate,a)||(i.form.startDate=a),a}),r(),s(25,"ui-input",21),h("ngModelChange",function(a){return g(i.form.endDate,a)||(i.form.endDate=a),a}),r()()(),s(26,"div",22)(27,"ui-button",23),p("clicked",function(){return i.closeModal()}),d(28," Cancel "),r(),s(29,"ui-button",24),p("clicked",function(){return i.save()}),d(30," Save "),r()()()()),e&2&&(m(8),c("options",i.academicYearOptions()),_("ngModel",i.selectedAcademicYearId),c("searchable",!0),m(),c("loading",i.isLoading),m(4),y(i.errorMessage?13:-1),m(),c("hoverable",!1),m(),y(i.isLoading?15:16),m(2),c("isOpen",i.isModalOpen)("title",i.modalTitle())("showFooter",!0),m(2),_("ngModel",i.form.name),m(),_("ngModel",i.form.shortCode),m(),c("options",i.classAcademicYearOptions()),_("ngModel",i.form.classAcademicYearId),c("disabled",i.modalMode==="edit")("searchable",!0),m(),c("options",i.statusOptions),_("ngModel",i.form.status),c("searchable",!0),m(2),_("ngModel",i.form.startDate),m(),_("ngModel",i.form.endDate),m(2),c("disabled",i.saveLoading),m(2),c("loading",i.saveLoading))},dependencies:[E,O,k,T,L,P,z,B,V,N,W,F,R,U],styles:[".page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.page__top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:1rem;flex-wrap:wrap}.page__title[_ngcontent-%COMP%]{font-weight:700;color:var(--text-primary)}.page__subtitle[_ngcontent-%COMP%]{color:var(--text-tertiary)}.page__actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap;align-items:flex-end}.page__loading[_ngcontent-%COMP%]{padding:2rem 0;display:flex;justify-content:center}.row-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem}.grid-2[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem}"]})};export{$ as DeanSemesters};
