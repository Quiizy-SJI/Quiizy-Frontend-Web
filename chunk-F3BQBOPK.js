import{a as R}from"./chunk-3PMPZBOS.js";import"./chunk-MD74L3HJ.js";import"./chunk-FWCO3CJY.js";import{a as q,b as F}from"./chunk-2WUHN5CQ.js";import{a as I}from"./chunk-MAWX5T35.js";import{u as j}from"./chunk-XGVRFAFZ.js";import"./chunk-4BWE2P25.js";import{d as P}from"./chunk-LM6INHLT.js";import{$a as f,A as v,Ab as O,Fa as z,Ib as V,Ka as _,Mb as A,Nb as D,Oa as M,Pb as E,Q,Va as b,Wa as w,ab as a,ba as m,bb as s,ca as u,cb as T,jb as g,l as x,lb as d,mc as S,nb as l,q as y,rc as h,yb as c,za as p,zb as k}from"./chunk-3XB4H34J.js";var B=()=>[];function U(n,t){if(n&1&&c(0),n&2){let e=l(),i=e.row,o=e.column;O(" ",i[o.key]," ")}}function Y(n,t){if(n&1){let e=g();a(0,"ui-button",3),d("clicked",function(){m(e);let o=l(2).row,r=l();return u(r.onPublish(o))}),c(1,"Publish"),s()}}function G(n,t){if(n&1){let e=g();a(0,"div",11)(1,"ui-button",10),d("clicked",function(){m(e);let o=l().row,r=l();return u(r.onEdit(o))}),c(2,"Edit"),s(),b(3,Y,2,0,"ui-button",12),a(4,"ui-button",13),d("clicked",function(){m(e);let o=l().row,r=l();return u(r.onDelete(o))}),c(5,"Delete"),s(),a(6,"ui-button",14),d("clicked",function(){m(e);let o=l().row,r=l();return u(r.onCreateFrom(o))}),c(7,"Create From"),s()()}if(n&2){let e=l().row;p(3),w(e.status==="DRAFT"?3:-1)}}function J(n,t){if(n&1&&b(0,U,1,1)(1,G,8,1,"div",11),n&2){let e=t.column;w(e.key!=="date"?0:1)}}var C=class n{constructor(t,e){this.teacherApi=t;this.router=e}quizzes$;loading=!1;confirmOpen=!1;confirmTitle="";confirmMessage="";confirmAction=null;pendingQuiz;columns=[{key:"title",label:"Title",width:"35%"},{key:"course",label:"Course",width:"20%"},{key:"status",label:"Status",width:"15%"},{key:"date",label:"Date",width:"15%"}];ngOnInit(){this.load()}load(){this.loading=!0,this.quizzes$=this.teacherApi.getMyQuizzes().pipe(y(t=>t.map(e=>({id:e.id,title:e.type?`${e.type} - ${e.author||""}`:e.author,course:e.courseQuizes?.[0]?.course?.teachingUnit?.name||e.courseQuizes?.[0]?.course?.classAcademicYear?.class?.name||"\u2014",status:e.status,date:e.date,_orig:e}))),Q(()=>this.loading=!1),v(()=>(this.loading=!1,x([]))))}onCreate(){this.router.navigate(["/teacher/create-exam"])}onEdit(t){let e=t._orig;this.router.navigate(["/teacher/create-exam"],{queryParams:{edit:e.id}})}onCreateFrom(t){let e=t._orig;this.router.navigate(["/teacher/create-exam"],{queryParams:{fromQuiz:e.id}})}onPublish(t){this.pendingQuiz=t._orig,this.confirmAction="publish",this.confirmTitle="Publish Quiz",this.confirmMessage="Publishing will create StudentQuiz entries and make the quiz read-only. Continue?",this.confirmOpen=!0}onDelete(t){this.pendingQuiz=t._orig,this.confirmAction="delete",this.confirmTitle="Delete Quiz",this.confirmMessage="This will permanently delete the quiz draft. Continue?",this.confirmOpen=!0}confirm(){if(!this.pendingQuiz||!this.confirmAction)return;let t=this.pendingQuiz.id;this.confirmAction==="publish"?this.teacherApi.publishQuiz(t).subscribe({next:()=>this.load(),error:e=>console.error("Publish failed",e)}):this.confirmAction==="delete"&&this.teacherApi.deleteQuiz(t).subscribe({next:()=>this.load(),error:e=>console.error("Delete failed",e)}),this.closeConfirm()}closeConfirm(){this.confirmOpen=!1,this.confirmAction=null,this.pendingQuiz=void 0}static \u0275fac=function(e){return new(e||n)(z(R),z(P))};static \u0275cmp=_({type:n,selectors:[["teacher-quiz-manager"]],decls:19,vars:14,consts:[["cell",""],["title","My Quizzes",3,"showHeader","showFooter"],["slot","header-right",1,"quiz-manager__header-actions"],["color","primary","size","sm",3,"clicked"],["color","secondary","size","sm",3,"clicked"],[1,"quiz-manager__table"],[3,"columns","data","loading","showHeader","showActions"],[3,"closed","isOpen","title","showFooter"],[1,"confirm-body"],["slot","footer"],["variant","soft","size","sm",3,"clicked"],[1,"quiz-manager__actions"],["color","primary","size","sm"],["color","danger","size","sm",3,"clicked"],["variant","ghost","size","sm",3,"clicked"]],template:function(e,i){if(e&1){let o=g();a(0,"ui-card",1)(1,"div",2)(2,"ui-button",3),d("clicked",function(){return m(o),u(i.load())}),c(3,"Refresh"),s(),a(4,"ui-button",4),d("clicked",function(){return m(o),u(i.onCreate())}),c(5,"Create Quiz"),s()(),a(6,"div",5)(7,"ui-table",6),A(8,"async"),M(9,J,2,1,"ng-template",null,0,E),s()(),a(11,"ui-modal",7),d("closed",function(){return m(o),u(i.closeConfirm())}),a(12,"div",8),c(13),s(),a(14,"div",9)(15,"ui-button",10),d("clicked",function(){return m(o),u(i.closeConfirm())}),c(16,"Cancel"),s(),a(17,"ui-button",3),d("clicked",function(){return m(o),u(i.confirm())}),c(18,"Continue"),s()()()()}e&2&&(f("showHeader",!0)("showFooter",!0),p(7),f("columns",i.columns)("data",D(8,11,i.quizzes$)||V(13,B))("loading",i.loading)("showHeader",!0)("showActions",!1),p(4),f("isOpen",i.confirmOpen)("title",i.confirmTitle)("showFooter",!0),p(2),k(i.confirmMessage))},dependencies:[h,F,j,q,I,S],styles:[".quiz-manager__header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.quiz-manager__table[_ngcontent-%COMP%]{margin-top:1rem}.quiz-manager__actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.confirm-body[_ngcontent-%COMP%]{padding:.5rem 0}"],changeDetection:0})};var $=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=_({type:n,selectors:[["app-teacher-exam-manager"]],decls:1,vars:0,template:function(e,i){e&1&&T(0,"teacher-quiz-manager")},dependencies:[h,C],encapsulation:2})};export{$ as TeacherExamManager};
