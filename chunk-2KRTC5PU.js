import{a as Z}from"./chunk-5HN4BRYP.js";import"./chunk-LSE4QE4L.js";import{f as G,j as K,n as X}from"./chunk-ZPZWYV2O.js";import"./chunk-DX4RU2C5.js";import{a as J,b as H}from"./chunk-C546SSYU.js";import"./chunk-KSJF27MU.js";import{c as A,d as Q,e as D,f as L,g as W,l as U,n as B,t as Y}from"./chunk-3OLBZRES.js";import{a as j,b as R}from"./chunk-YL2QS7YU.js";import"./chunk-HQOA22C6.js";import{b as N,d as k,h as V}from"./chunk-3WAO3F22.js";import{$a as p,Ab as F,Db as h,Eb as C,Fb as _,Ka as P,Tb as O,Va as f,Wa as y,Xb as T,Z as x,a as z,ab as i,ba as m,bb as n,ca as u,cb as S,jb as q,la as w,lb as M,nb as d,p as b,rc as I,yb as a,za as l,zb as E}from"./chunk-T26DWB6S.js";function te(c,r){c&1&&(i(0,"div",11),S(1,"ui-spinner",14),i(2,"p"),a(3,"Loading courses..."),n()())}function ie(c,r){if(c&1){let e=q();i(0,"ui-alert",12)(1,"mat-icon",15),a(2,"error"),n(),a(3),i(4,"ui-button",16),M("clicked",function(){m(e);let o=d();return u(o.loadCourses())}),a(5," Retry "),n()()}if(c&2){let e=d();l(3),F(" ",e.errorMessage()," ")}}function ne(c,r){if(c&1&&(i(0,"div",21)(1,"mat-icon"),a(2,"info"),n(),i(3,"span"),a(4),n()()),c&2){let e=d(2);l(4),E(e.selectedCourseInfo())}}function re(c,r){if(c&1){let e=q();i(0,"ui-card",13)(1,"form",17),M("ngSubmit",function(){m(e);let o=d();return u(o.nextStep())}),i(2,"div",18)(3,"h3"),a(4,"Select Course"),n(),i(5,"p",19),a(6,"Choose the course for this quiz. All students enrolled in this course will be automatically invited."),n(),i(7,"ui-select",20),_("ngModelChange",function(o){m(e);let s=d();return C(s.quizForm.courseId,o)||(s.quizForm.courseId=o),u(o)}),n(),f(8,ne,5,1,"div",21),n(),i(9,"div",18)(10,"h3"),a(11,"Quiz Configuration"),n(),i(12,"div",22)(13,"ui-select",23),_("ngModelChange",function(o){m(e);let s=d();return C(s.quizForm.type,o)||(s.quizForm.type=o),u(o)}),n(),i(14,"ui-input",24),_("ngModelChange",function(o){m(e);let s=d();return C(s.quizForm.lectures,o)||(s.quizForm.lectures=o),u(o)}),n()()(),i(15,"div",18)(16,"h3"),a(17,"Schedule"),n(),i(18,"p",19),a(19,"Set when the quiz will be available and how long students have to complete it."),n(),i(20,"div",22)(21,"ui-input",25),_("ngModelChange",function(o){m(e);let s=d();return C(s.quizForm.date,o)||(s.quizForm.date=o),u(o)}),n(),i(22,"ui-input",26),_("ngModelChange",function(o){m(e);let s=d();return C(s.quizForm.durationMinutes,o)||(s.quizForm.durationMinutes=o),u(o)}),n()()(),i(23,"div",27)(24,"ui-button",28),M("clicked",function(){m(e);let o=d();return u(o.goBack())}),i(25,"mat-icon",29),a(26,"arrow_back"),n(),a(27," Cancel "),n(),i(28,"ui-button",30),M("clicked",function(){m(e);let o=d();return u(o.nextStep())}),a(29," Next: Add Questions "),i(30,"mat-icon",31),a(31,"arrow_forward"),n()()()()()}if(c&2){let e=d();l(7),p("options",e.courseOptions())("required",!0),h("ngModel",e.quizForm.courseId),l(),y(e.selectedCourseInfo()?8:-1),l(5),p("options",e.quizTypeOptions)("required",!0),h("ngModel",e.quizForm.type),l(),p("required",!0)("min",1),h("ngModel",e.quizForm.lectures),l(7),p("required",!0),h("ngModel",e.quizForm.date),l(),p("required",!0)("min",1),h("ngModel",e.quizForm.durationMinutes),l(6),p("disabled",!e.isFormValid())}}var $=class c{teacherApi=x(Z);router=x(k);route=x(N);cdr=x(T);isLoading=w(!1);errorMessage=w("");courses=w([]);quizForm={courseId:"",type:"",lectures:1,date:"",durationMinutes:60};quizTypeOptions=[{value:"CA",label:"Continuous Assessment (CA)"},{value:"MEDIAN",label:"Midterm Exam"},{value:"FINAL",label:"Final Exam"},{value:"MOCK",label:"Mock Test / Practice"}];courseOptions=O(()=>this.courses().map(r=>({value:r.id,label:this.getCourseLabel(r)})));selectedCourseInfo=O(()=>{if(!this.quizForm.courseId)return"";let r=this.courses().find(v=>v.id===this.quizForm.courseId);if(!r)return"";let e=r.classAcademicYear?.class?.name??"",t=r.classAcademicYear?.class?.level??r.level??"",o=r.credits,s=[];return e&&s.push(`Class: ${e}`),t&&s.push(`Level: ${t}`),o&&s.push(`${o} credits`),s.join(" \u2022 ")});async ngOnInit(){this.loadSavedData(),await this.loadCourses(),this.handleQueryParams()}async handleQueryParams(){let r=this.route.snapshot.queryParamMap,e=r.get("edit")||r.get("draft")||r.get("fromQuiz");if(e)try{this.isLoading.set(!0);let t=await b(this.teacherApi.getQuiz(String(e))),s={courseId:t.courseQuizes?.[0]?.course?.id??"",type:t.type,lectures:Number(t.lectures)||1,date:String(t.date)||"",durationMinutes:Number(t.durationMinutes)||60,teachingUnitId:t.courseQuizes?.[0]?.course?.teachingUnit?.id??"",teachingUnitName:t.courseQuizes?.[0]?.course?.teachingUnit?.name??""};sessionStorage.setItem("examFormStep1",JSON.stringify(s));let v=[],ee=t.courseQuizes?.[0]?.courseQuizQuestions??[];for(let g of ee)g.question&&v.push({question:g.question.question,type:g.question.type,proposedAnswers:g.question.proposedAnswers??[],correctAnswer:g.question.correctAnswer??"",markAllocation:Number(g.markAllocation)||1});sessionStorage.setItem("examFormStep2",JSON.stringify({questions:v})),sessionStorage.setItem("examEditingId",String(e)),this.router.navigate(["/teacher/create-exam/step2"])}catch(t){this.errorMessage.set("Failed to load quiz for editing. You can start a new quiz instead."),console.warn("Failed to load quiz for edit/fromQuiz:",t)}finally{this.isLoading.set(!1),this.cdr.markForCheck()}}loadSavedData(){let r=sessionStorage.getItem("examFormStep1");if(r)try{let e=JSON.parse(r);this.quizForm=z(z({},this.quizForm),e)}catch{}}async loadCourses(){this.isLoading.set(!0),this.errorMessage.set("");try{let r=await b(this.teacherApi.getMyCourses());this.courses.set(r)}catch(r){this.errorMessage.set(r instanceof Error?r.message:"Failed to load courses. Please try again.")}finally{this.isLoading.set(!1),this.cdr.markForCheck()}}getCourseLabel(r){let e=r.teachingUnit?.name??"Unknown Subject",t=r.classAcademicYear?.class?.name??"";return t?`${e} \u2014 ${t}`:e}isFormValid(){return!!(this.quizForm.courseId&&this.quizForm.type&&this.quizForm.date&&this.quizForm.durationMinutes>0&&this.quizForm.lectures>0)}goBack(){this.router.navigate(["/teacher/exam-manager"])}nextStep(){if(!this.isFormValid())return;let r={courseId:String(this.quizForm.courseId),type:String(this.quizForm.type),lectures:Number(this.quizForm.lectures),date:String(this.quizForm.date),durationMinutes:Number(this.quizForm.durationMinutes),teachingUnitId:this.courses().find(t=>t.id===String(this.quizForm.courseId))?.teachingUnit?.id??"",teachingUnitName:this.courses().find(t=>t.id===String(this.quizForm.courseId))?.teachingUnit?.name??""};sessionStorage.setItem("examFormStep1",JSON.stringify(r)),this.router.navigate(["/teacher/create-exam/step2"])}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=P({type:c,selectors:[["app-teacher-create-exam"]],decls:37,vars:3,consts:[[1,"create-exam"],[1,"page-header"],["variant","elevated",1,"stepper-card"],[1,"progress-stepper"],[1,"step","active"],[1,"step-number"],[1,"step-info"],[1,"step-title"],[1,"step-desc"],[1,"step-connector"],[1,"step"],[1,"loading-state"],["variant","filled","color","danger"],["variant","elevated","title","Quiz Details"],["size","lg"],["slot","icon"],["slot","action","variant","outline","color","danger","size","sm",3,"clicked"],[1,"quiz-form",3,"ngSubmit"],[1,"form-section"],[1,"section-hint"],["label","Course","placeholder","Select a course","name","courseId",3,"ngModelChange","options","required","ngModel"],[1,"course-preview"],[1,"form-row"],["label","Quiz Type","placeholder","Select quiz type","name","type",3,"ngModelChange","options","required","ngModel"],["type","number","label","Number of Lectures Covered","placeholder","e.g., 3","name","lectures","helperText","How many lectures does this quiz cover?",3,"ngModelChange","required","min","ngModel"],["type","datetime-local","label","Quiz Date & Time","name","date","helperText","When the quiz becomes available",3,"ngModelChange","required","ngModel"],["type","number","label","Duration (minutes)","placeholder","60","name","durationMinutes","helperText","Time limit for completion",3,"ngModelChange","required","min","ngModel"],[1,"form-actions"],["variant","outline","color","neutral",3,"clicked"],["slot","icon-left"],["variant","solid","color","primary",3,"clicked","disabled"],["slot","icon-right"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),a(3,"Create New Quiz"),n(),i(4,"p"),a(5,"Set up your quiz details. Students will be automatically invited based on the selected course."),n()(),i(6,"ui-card",2)(7,"div",3)(8,"div",4)(9,"div",5),a(10,"1"),n(),i(11,"div",6)(12,"span",7),a(13,"Quiz Details"),n(),i(14,"span",8),a(15,"Course, type & schedule"),n()()(),S(16,"div",9),i(17,"div",10)(18,"div",5),a(19,"2"),n(),i(20,"div",6)(21,"span",7),a(22,"Add Questions"),n(),i(23,"span",8),a(24,"Build your quiz"),n()()(),S(25,"div",9),i(26,"div",10)(27,"div",5),a(28,"3"),n(),i(29,"div",6)(30,"span",7),a(31,"Review & Publish"),n(),i(32,"span",8),a(33,"Final review"),n()()()()(),f(34,te,4,0,"div",11),f(35,ie,6,1,"ui-alert",12),f(36,re,32,16,"ui-card",13),n()),e&2&&(l(34),y(t.isLoading()?34:-1),l(),y(t.errorMessage()?35:-1),l(),y(!t.isLoading()&&!t.errorMessage()?36:-1))},dependencies:[I,R,j,V,B,W,A,Q,U,L,D,H,J,Y,G,X,K],styles:[".create-exam[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;margin-bottom:.5rem;color:var(--color-text-primary)}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:.938rem}.stepper-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.progress-stepper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:1rem 0}@media (max-width: 640px){.progress-stepper[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{width:2.25rem;height:2.25rem;border-radius:50%;background:var(--color-background-muted);color:var(--color-text-secondary);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.938rem;transition:all .2s ease}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--color-primary-600);color:#fff}.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--color-success-600);color:#fff}.step[_ngcontent-%COMP%]   .step-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.step[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--color-text-primary)}.step.active[_ngcontent-%COMP%]   .step-title[_ngcontent-%COMP%]{color:var(--color-primary-600);font-weight:600}.step[_ngcontent-%COMP%]   .step-desc[_ngcontent-%COMP%]{font-size:.75rem;color:var(--color-text-tertiary)}.step-connector[_ngcontent-%COMP%]{flex:1;height:2px;background:var(--color-border-default);margin:0 1.5rem;max-width:80px}@media (max-width: 640px){.step-connector[_ngcontent-%COMP%]{display:none}}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;color:var(--color-text-secondary)}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:1rem}.quiz-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;margin-bottom:.5rem;color:var(--color-text-primary)}.form-section[_ngcontent-%COMP%]   .section-hint[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary);margin-bottom:1rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}.course-preview[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.75rem;padding:.75rem 1rem;background:var(--color-primary-50);border:1px solid var(--color-primary-200);border-radius:8px;font-size:.875rem;color:var(--color-primary-700)}.course-preview[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:1.5rem;border-top:1px solid var(--color-border-subtle)}@media (max-width: 480px){.form-actions[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.form-actions[_ngcontent-%COMP%]   ui-button[_ngcontent-%COMP%]{width:100%}}[_nghost-%COMP%]     ui-card{margin-bottom:1.5rem}[_nghost-%COMP%]     .card__body{padding:1.5rem}"]})};export{$ as TeacherCreateExam};
